@* Componente de mensajes estilo hospital - Sin animaciones, cierre explícito *@

@if (messages.Any())
{
    <div style="position: fixed; top: 20px; right: 20px; z-index: 10000; min-width: 400px; max-width: 600px;">
        @foreach (var msg in messages)
        {
            <div style="@GetMessageStyle(msg.Type)" @key="msg.Id">
                <div style="display: flex; justify-content: space-between; align-items: start;">
                    <div style="flex: 1;">
                        @if (!string.IsNullOrEmpty(msg.Title))
                        {
                            <div style="font-family: 'Courier New', monospace; font-size: 14px; 
                                        font-weight: bold; margin-bottom: 8px; letter-spacing: 1px;">
                                @msg.Title
                            </div>
                        }
                        <div style="font-family: 'Courier New', monospace; font-size: 12px; line-height: 1.4;">
                            @msg.Message
                        </div>
                    </div>
                    <button @onclick="() => RemoveMessage(msg.Id)" 
                            style="font-family: 'Courier New', monospace; font-size: 16px; font-weight: bold; 
                                   background-color: transparent; border: 1px solid #000000; 
                                   padding: 4px 10px; margin-left: 15px; cursor: pointer; color: inherit;">
                        X
                    </button>
                </div>
            </div>
        }
    </div>
}

@code {
    private List<ToastMessage> messages = new();
    private int nextId = 1;

    public enum ToastType
    {
        Success,
        Error,
        Warning,
        Info
    }

    private class ToastMessage
    {
        public int Id { get; set; }
        public ToastType Type { get; set; }
        public string? Title { get; set; }
        public string Message { get; set; } = "";
    }

    private string GetMessageStyle(ToastType type)
    {
        // Colores según tipo: rojo=error, amarillo=advertencia, verde=éxito, gris=info
        var (bgColor, textColor, borderColor) = type switch
        {
            ToastType.Error => ("#cc0000", "#ffffff", "#000000"),
            ToastType.Warning => ("#ffcc00", "#000000", "#000000"),
            ToastType.Success => ("#009900", "#ffffff", "#000000"),
            _ => ("#f0f0f0", "#000000", "#000000")
        };

        return $"background-color: {bgColor}; color: {textColor}; border: 2px solid {borderColor}; "
             + $"padding: 15px; margin-bottom: 10px; box-shadow: 2px 2px 0px #000000;";
    }

    /// <summary>
    /// Muestra un mensaje de éxito - NO se cierra automáticamente
    /// </summary>
    public void ShowSuccess(string message, string? title = null)
    {
        AddMessage(ToastType.Success, message, title ?? "OPERACION EXITOSA");
    }

    /// <summary>
    /// Muestra un mensaje de error - NO se cierra automáticamente
    /// </summary>
    public void ShowError(string message, string? title = "ERROR")
    {
        AddMessage(ToastType.Error, message, title);
    }

    /// <summary>
    /// Muestra un mensaje de advertencia - NO se cierra automáticamente
    /// </summary>
    public void ShowWarning(string message, string? title = "ADVERTENCIA")
    {
        AddMessage(ToastType.Warning, message, title);
    }

    /// <summary>
    /// Muestra un mensaje informativo - NO se cierra automáticamente
    /// </summary>
    public void ShowInfo(string message, string? title = null)
    {
        AddMessage(ToastType.Info, message, title ?? "INFORMACION");
    }

    private void AddMessage(ToastType type, string message, string? title)
    {
        var msg = new ToastMessage
        {
            Id = nextId++,
            Type = type,
            Title = title,
            Message = message
        };

        messages.Add(msg);
        StateHasChanged();
        
        // SIN auto-cierre - El usuario DEBE cerrar manualmente
    }

    private void RemoveMessage(int id)
    {
        messages.RemoveAll(m => m.Id == id);
        StateHasChanged();
    }

    /// <summary>
    /// Limpia todos los mensajes
    /// </summary>
    public void ClearAll()
    {
        messages.Clear();
        StateHasChanged();
    }
}


