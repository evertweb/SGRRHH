@* Componente reutilizable de mensajes (Toast) *@

@if (messages.Any())
{
    <div class="toast-container">
        @foreach (var msg in messages)
        {
            <div class="toast toast-@msg.Type.ToString().ToLower() @(msg.IsClosing ? "toast-closing" : "")" @key="msg.Id">
                <div class="toast-icon">
                    @switch (msg.Type)
                    {
                        case ToastType.Success:
                            <span>✓</span>
                            break;
                        case ToastType.Error:
                            <span>✕</span>
                            break;
                        case ToastType.Warning:
                            <span>⚠</span>
                            break;
                        case ToastType.Info:
                            <span>ℹ</span>
                            break;
                    }
                </div>
                <div class="toast-content">
                    @if (!string.IsNullOrEmpty(msg.Title))
                    {
                        <strong class="toast-title">@msg.Title</strong>
                    }
                    <span class="toast-message">@msg.Message</span>
                </div>
                <button class="toast-close" @onclick="() => RemoveMessage(msg.Id)">×</button>
            </div>
        }
    </div>
}

@code {
    private List<ToastMessage> messages = new();
    private int nextId = 1;

    public enum ToastType
    {
        Success,
        Error,
        Warning,
        Info
    }

    private class ToastMessage
    {
        public int Id { get; set; }
        public ToastType Type { get; set; }
        public string? Title { get; set; }
        public string Message { get; set; } = "";
        public bool IsClosing { get; set; }
    }

    /// <summary>
    /// Muestra un mensaje de éxito
    /// </summary>
    public void ShowSuccess(string message, string? title = null, int durationMs = 3000)
    {
        AddMessage(ToastType.Success, message, title, durationMs);
    }

    /// <summary>
    /// Muestra un mensaje de error
    /// </summary>
    public void ShowError(string message, string? title = "ERROR", int durationMs = 5000)
    {
        AddMessage(ToastType.Error, message, title, durationMs);
    }

    /// <summary>
    /// Muestra un mensaje de advertencia
    /// </summary>
    public void ShowWarning(string message, string? title = null, int durationMs = 4000)
    {
        AddMessage(ToastType.Warning, message, title, durationMs);
    }

    /// <summary>
    /// Muestra un mensaje informativo
    /// </summary>
    public void ShowInfo(string message, string? title = null, int durationMs = 3000)
    {
        AddMessage(ToastType.Info, message, title, durationMs);
    }

    private void AddMessage(ToastType type, string message, string? title, int durationMs)
    {
        var msg = new ToastMessage
        {
            Id = nextId++,
            Type = type,
            Title = title,
            Message = message
        };

        messages.Add(msg);
        StateHasChanged();

        // Auto-close after duration
        if (durationMs > 0)
        {
            var msgId = msg.Id;
            _ = Task.Run(async () =>
            {
                await Task.Delay(durationMs);
                await InvokeAsync(() => RemoveMessage(msgId));
            });
        }
    }

    private void RemoveMessage(int id)
    {
        var msg = messages.FirstOrDefault(m => m.Id == id);
        if (msg != null)
        {
            msg.IsClosing = true;
            StateHasChanged();

            // Remove after animation
            _ = Task.Run(async () =>
            {
                await Task.Delay(300);
                await InvokeAsync(() =>
                {
                    messages.RemoveAll(m => m.Id == id);
                    StateHasChanged();
                });
            });
        }
    }

    /// <summary>
    /// Limpia todos los mensajes
    /// </summary>
    public void ClearAll()
    {
        messages.Clear();
        StateHasChanged();
    }
}

<style>
    .toast-container {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 9999;
        display: flex;
        flex-direction: column;
        gap: 8px;
        max-width: 400px;
    }

    .toast {
        display: flex;
        align-items: flex-start;
        padding: 12px 16px;
        border-radius: 4px;
        border: 2px solid;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        animation: slideIn 0.3s ease-out;
        font-family: 'Courier New', monospace;
        font-size: 12px;
    }

    .toast-closing {
        animation: slideOut 0.3s ease-out forwards;
    }

    .toast-success {
        background-color: #CCFFCC;
        border-color: #00AA00;
        color: #006600;
    }

    .toast-error {
        background-color: #FFCCCC;
        border-color: #CC0000;
        color: #660000;
    }

    .toast-warning {
        background-color: #FFFFCC;
        border-color: #CC9900;
        color: #664400;
    }

    .toast-info {
        background-color: #CCE5FF;
        border-color: #0066CC;
        color: #003366;
    }

    .toast-icon {
        font-size: 18px;
        margin-right: 12px;
        flex-shrink: 0;
    }

    .toast-content {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 4px;
    }

    .toast-title {
        font-weight: bold;
        font-size: 13px;
    }

    .toast-message {
        line-height: 1.4;
    }

    .toast-close {
        background: none;
        border: none;
        font-size: 18px;
        cursor: pointer;
        margin-left: 12px;
        padding: 0;
        line-height: 1;
        opacity: 0.6;
        color: inherit;
    }

    .toast-close:hover {
        opacity: 1;
    }

    @@keyframes slideIn {
        from {
            transform: translateX(100%);
            opacity: 0;
        }
        to {
            transform: translateX(0);
            opacity: 1;
        }
    }

    @@keyframes slideOut {
        from {
            transform: translateX(0);
            opacity: 1;
        }
        to {
            transform: translateX(100%);
            opacity: 0;
        }
    }
</style>
