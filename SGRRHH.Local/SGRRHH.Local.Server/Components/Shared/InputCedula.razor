@using SGRRHH.Local.Shared.Helpers

<input type="text" 
       class="@CssClass" 
       value="@ValorFormateado"
       @oninput="OnInputChanged"
       @onblur="OnBlur"
       disabled="@Disabled"
       readonly="@ReadOnly"
       placeholder="@Placeholder"
       maxlength="@MaxLength" />

@code {
    [Parameter]
    public string? Value { get; set; }
    
    [Parameter]
    public EventCallback<string?> ValueChanged { get; set; }
    
    [Parameter]
    public string? CssClass { get; set; }
    
    [Parameter]
    public bool Disabled { get; set; }
    
    [Parameter]
    public bool ReadOnly { get; set; }
    
    [Parameter]
    public string? Placeholder { get; set; } = "Ej: 1.192.208.848";
    
    [Parameter]
    public int MaxLength { get; set; } = 20;
    
    private string ValorFormateado => !string.IsNullOrEmpty(Value) 
        ? NumberFormatHelper.FormatearCedula(Value) 
        : "";
    
    private async Task OnInputChanged(ChangeEventArgs e)
    {
        var texto = e.Value?.ToString() ?? "";
        
        // Extraer solo n√∫meros para almacenar
        var soloNumeros = new string(texto.Where(char.IsDigit).ToArray());
        
        await ValueChanged.InvokeAsync(soloNumeros);
    }
    
    private void OnBlur(FocusEventArgs e)
    {
        // Re-formatear al perder foco
        StateHasChanged();
    }
}
