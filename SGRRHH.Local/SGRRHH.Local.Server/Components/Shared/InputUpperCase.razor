@namespace SGRRHH.Local.Server.Components.Shared

<input type="text"
       id="@Id"
       class="@CssClass"
       style="text-transform: uppercase;"
       value="@Value"
       @oninput="OnInput"
       @onblur="OnBlur"
       maxlength="@MaxLength"
       placeholder="@Placeholder"
       readonly="@Readonly"
       disabled="@Disabled"
       tabindex="@TabIndex" />

@code {
    [Parameter] public string? Id { get; set; }
    [Parameter] public string? Value { get; set; }
    [Parameter] public EventCallback<string> ValueChanged { get; set; }
    [Parameter] public string CssClass { get; set; } = "hospital-input";
    [Parameter] public int MaxLength { get; set; } = 100;
    [Parameter] public string? Placeholder { get; set; }
    [Parameter] public bool Readonly { get; set; }
    [Parameter] public bool Disabled { get; set; }
    [Parameter] public int TabIndex { get; set; } = 0;
    
    /// <summary>
    /// Evento opcional que se dispara cuando el valor cambia (además del two-way binding)
    /// </summary>
    [Parameter] public EventCallback<string> OnValueChanged { get; set; }

    private async Task OnInput(ChangeEventArgs e)
    {
        var newValue = e.Value?.ToString()?.ToUpperInvariant() ?? string.Empty;
        Value = newValue;
        await ValueChanged.InvokeAsync(newValue);
        
        if (OnValueChanged.HasDelegate)
        {
            await OnValueChanged.InvokeAsync(newValue);
        }
    }
    
    private void OnBlur(FocusEventArgs e)
    {
        // Asegurar mayúsculas al perder foco (por si el CSS no lo manejó)
        if (!string.IsNullOrEmpty(Value))
        {
            var upperValue = Value.ToUpperInvariant();
            if (upperValue != Value)
            {
                Value = upperValue;
                ValueChanged.InvokeAsync(upperValue);
            }
        }
    }
}
