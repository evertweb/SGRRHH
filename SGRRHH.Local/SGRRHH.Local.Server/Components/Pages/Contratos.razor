@page "/contratos"
@page "/contratos/{EmpleadoIdParam:int?}"
@using SGRRHH.Local.Domain.Entities
@using SGRRHH.Local.Domain.Enums
@using SGRRHH.Local.Shared.Interfaces
@using Microsoft.AspNetCore.Components.Forms
@inject IAuthService AuthService
@inject IContratoRepository ContratoRepository
@inject IEmpleadoRepository EmpleadoRepository
@inject ICargoRepository CargoRepository
@inject ILocalStorageService StorageService
@inject NavigationManager Navigation
@inject ILogger<Contratos> Logger
@inject IJSRuntime JSRuntime

<PageTitle>Contratos - SGRRHH</PageTitle>

<KeyboardHandler @ref="keyboardHandler" Shortcuts="shortcuts" ShowShortcutBar="true" />

<h1 class="page-title">GESTI√ìN DE CONTRATOS</h1>

@if (errorMessage != null)
{
    <div class="error-block">
        <h3>ERROR</h3>
        <p>@errorMessage</p>
        <button @onclick="() => errorMessage = null">ACEPTAR</button>
    </div>
}

@if (successMessage != null)
{
    <div class="success-block">
        <p>@successMessage</p>
    </div>
}

<!-- Toolbar -->
<div class="toolbar">
    <div class="toolbar-group">
        <button class="btn-primary" @onclick="NuevoContrato">NUEVO (F3)</button>
        <button @onclick="CargarContratos">ACTUALIZAR (F5)</button>
        @if (selectedContrato != null)
        {
            <button @onclick="EditarSeleccionado">EDITAR (F4)</button>
        }
    </div>
    
    <div class="toolbar-separator"></div>
    
    <div class="search-box">
        <input type="text" id="searchInput" placeholder="Buscar empleado... (F2)" 
               @bind="searchTerm" @bind:event="oninput" @onkeyup="OnSearchKeyUp" />
        <button @onclick="Buscar">BUSCAR</button>
        @if (!string.IsNullOrEmpty(searchTerm))
        {
            <button @onclick="LimpiarBusqueda">LIMPIAR</button>
        }
        <select @bind="filtroEstado" @bind:after="Filtrar">
            <option value="">Todos los estados</option>
            <option value="@((int)EstadoContrato.Activo)">Activos</option>
            <option value="@((int)EstadoContrato.Finalizado)">Finalizados</option>
            <option value="@((int)EstadoContrato.Renovado)">Renovados</option>
            <option value="@((int)EstadoContrato.Cancelado)">Cancelados</option>
        </select>
        <select @bind="filtroTipo" @bind:after="Filtrar">
            <option value="">Todos los tipos</option>
            <option value="@((int)TipoContrato.Indefinido)">Indefinido</option>
            <option value="@((int)TipoContrato.Fijo)">Fijo</option>
            <option value="@((int)TipoContrato.ObraLabor)">Obra o Labor</option>
            <option value="@((int)TipoContrato.PrestacionServicios)">Prestaci√≥n Servicios</option>
            <option value="@((int)TipoContrato.Aprendizaje)">Aprendizaje</option>
        </select>
    </div>
</div>

<!-- Informaci√≥n de resultados -->
<div class="results-info">
    Mostrando @contratos.Count() de @totalContratos contrato(s)
</div>

<!-- Tabla de contratos -->
<table>
    <thead>
        <tr>
            <th style="width: 100px;">C√ìDIGO EMP.</th>
            <th>EMPLEADO</th>
            <th>TIPO</th>
            <th>CARGO</th>
            <th>FECHA INICIO</th>
            <th>FECHA FIN</th>
            <th>SALARIO</th>
            <th style="width: 100px;">ESTADO</th>
            <th style="width: 200px;">ACCIONES</th>
        </tr>
    </thead>
    <tbody>
        @if (isLoading)
        {
            <tr><td colspan="9" class="loading">Cargando contratos...</td></tr>
        }
        else if (!contratos.Any())
        {
            <tr><td colspan="9" class="empty-state">No hay contratos para mostrar</td></tr>
        }
        else
        {
            @foreach (var contrato in contratos)
            {
                var diasParaVencer = contrato.FechaFin.HasValue ? (contrato.FechaFin.Value - DateTime.Today).Days : 0;
                var porVencer = contrato.Estado == EstadoContrato.Activo && contrato.FechaFin.HasValue && diasParaVencer > 0 && diasParaVencer <= 30;
                
                <tr class="@(selectedContrato?.Id == contrato.Id ? "selected" : "") @(porVencer ? "row-warning" : "")"
                    @onclick="() => SelectContrato(contrato)">
                    <td>@(contrato.Empleado?.Codigo ?? "-")</td>
                    <td><strong>@(contrato.Empleado?.NombreCompleto ?? "Sin empleado")</strong></td>
                    <td>@GetTipoContratoDisplay(contrato.TipoContrato)</td>
                    <td>@(contrato.Cargo?.Nombre ?? "-")</td>
                    <td>@contrato.FechaInicio.ToString("dd/MM/yyyy")</td>
                    <td>
                        @if (contrato.FechaFin.HasValue)
                        {
                            <span>@contrato.FechaFin.Value.ToString("dd/MM/yyyy")</span>
                            @if (porVencer)
                            {
                                <span class="text-warning"> (@diasParaVencer d√≠as)</span>
                            }
                        }
                        else
                        {
                            <span class="text-muted">Indefinido</span>
                        }
                    </td>
                    <td class="text-right">@contrato.Salario.ToString("C0")</td>
                    <td>
                        <span class="badge badge-@contrato.Estado.ToString().ToLower()">
                            @contrato.Estado
                        </span>
                    </td>
                    <td class="table-actions">
                        <button @onclick="() => EditarContrato(contrato)" @onclick:stopPropagation="true">
                            EDITAR
                        </button>
                        @if (!string.IsNullOrEmpty(contrato.ArchivoAdjuntoPath))
                        {
                            <button @onclick="() => DescargarAdjunto(contrato)" @onclick:stopPropagation="true">
                                ARCHIVO
                            </button>
                        }
                        <button @onclick="() => VerHistorial(contrato)" @onclick:stopPropagation="true">
                            HISTORIAL
                        </button>
                    </td>
                </tr>
            }
        }
    </tbody>
</table>

<!-- Panel de estad√≠sticas de contratos por vencer -->
@if (contratosPorVencer.Any())
{
    <div class="alert alert-warning" style="margin-top: 24px;">
        <h4>‚ö† CONTRATOS POR VENCER (PR√ìXIMOS 30 D√çAS)</h4>
        <ul>
            @foreach (var contrato in contratosPorVencer)
            {
                var dias = contrato.FechaFin.HasValue ? (contrato.FechaFin.Value - DateTime.Today).Days : 0;
                <li>
                    <strong>@(contrato.Empleado?.NombreCompleto ?? "Sin empleado")</strong> - 
                    Vence @contrato.FechaFin?.ToString("dd/MM/yyyy") 
                    <span class="text-warning">(@dias d√≠as)</span>
                </li>
            }
        </ul>
    </div>
}

<!-- Modal de Contrato (Nuevo/Editar) -->
<FormModal @bind-IsVisible="showModal" 
           Title="@(isEditing ? "EDITAR CONTRATO" : "NUEVO CONTRATO")"
           Width="800px"
           OnSaveClicked="GuardarContrato"
           OnCancelClicked="CerrarModal"
           IsSaving="isSaving">
    
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
        <!-- Columna izquierda -->
        <div>
            <div class="form-group required">
                <label>Empleado:</label>
                <select @bind="contratoEdit.EmpleadoId" disabled="@isEditing">
                    <option value="">-- Seleccione --</option>
                    @foreach (var emp in empleados)
                    {
                        <option value="@emp.Id">@emp.Codigo - @emp.NombreCompleto</option>
                    }
                </select>
                @if (isEditing)
                {
                    <small style="color: #666; font-size: 10px;">El empleado no puede ser modificado</small>
                }
            </div>
            
            <div class="form-group required">
                <label>Tipo de Contrato:</label>
                <select @bind="contratoEdit.TipoContrato">
                    @foreach (var tipo in Enum.GetValues<TipoContrato>())
                    {
                        <option value="@tipo">@GetTipoContratoDisplay(tipo)</option>
                    }
                </select>
            </div>
            
            <div class="form-group required">
                <label>Cargo:</label>
                <select @bind="contratoEdit.CargoId">
                    <option value="">-- Seleccione --</option>
                    @foreach (var cargo in cargos)
                    {
                        <option value="@cargo.Id">@cargo.Nombre</option>
                    }
                </select>
            </div>
            
            <div class="form-group required">
                <label>Estado:</label>
                <select @bind="contratoEdit.Estado">
                    @foreach (var estado in Enum.GetValues<EstadoContrato>())
                    {
                        <option value="@estado">@estado</option>
                    }
                </select>
            </div>
        </div>
        
        <!-- Columna derecha -->
        <div>
            <div class="form-group required">
                <label>Fecha Inicio:</label>
                <input type="date" @bind="contratoEdit.FechaInicio" />
            </div>
            
            <div class="form-group">
                <label>Fecha Fin:</label>
                <input type="date" @bind="contratoEdit.FechaFin" />
                <small style="color: #666; font-size: 10px;">
                    Dejar vac√≠o para contratos indefinidos
                </small>
            </div>
            
            <div class="form-group required">
                <label>Salario:</label>
                <input type="number" step="0.01" @bind="contratoEdit.Salario" />
            </div>
            
            <div class="form-group">
                <label>Documento Adjunto:</label>
                <InputFile OnChange="OnArchivoSelected" accept=".pdf,.doc,.docx" />
                @if (!string.IsNullOrEmpty(contratoEdit.ArchivoAdjuntoPath))
                {
                    <small style="color: #0066CC; font-size: 10px;">
                        üìé Archivo: @System.IO.Path.GetFileName(contratoEdit.ArchivoAdjuntoPath)
                    </small>
                }
            </div>
        </div>
    </div>
    
    <!-- Observaciones en ancho completo -->
    <div class="form-group" style="margin-top: 16px;">
        <label>Observaciones:</label>
        <textarea @bind="contratoEdit.Observaciones" rows="3"></textarea>
    </div>
</FormModal>

<!-- Modal de Historial de Contratos -->
<FormModal @bind-IsVisible="showHistorialModal" 
           Title="@($"HISTORIAL DE CONTRATOS - {empleadoSeleccionado?.NombreCompleto}")"
           Width="900px"
           ShowSaveButton="false"
           OnCancelClicked="() => showHistorialModal = false">
    
    @if (historialContratos.Any())
    {
        <table>
            <thead>
                <tr>
                    <th>TIPO</th>
                    <th>CARGO</th>
                    <th>FECHA INICIO</th>
                    <th>FECHA FIN</th>
                    <th>SALARIO</th>
                    <th>ESTADO</th>
                    <th>ACCIONES</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var contrato in historialContratos.OrderByDescending(c => c.FechaInicio))
                {
                    <tr>
                        <td>@GetTipoContratoDisplay(contrato.TipoContrato)</td>
                        <td>@(contrato.Cargo?.Nombre ?? "-")</td>
                        <td>@contrato.FechaInicio.ToString("dd/MM/yyyy")</td>
                        <td>@(contrato.FechaFin?.ToString("dd/MM/yyyy") ?? "Indefinido")</td>
                        <td class="text-right">@contrato.Salario.ToString("C0")</td>
                        <td>
                            <span class="badge badge-@contrato.Estado.ToString().ToLower()">
                                @contrato.Estado
                            </span>
                        </td>
                        <td class="table-actions">
                            <button @onclick="() => EditarContratoFromHistorial(contrato)">
                                VER/EDITAR
                            </button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
        
        @if (!string.IsNullOrEmpty(historialContratos.FirstOrDefault()?.Observaciones))
        {
            <div class="info-box" style="margin-top: 16px;">
                <strong>OBSERVACIONES DEL √öLTIMO CONTRATO:</strong>
                <p style="margin: 8px 0 0 0; white-space: pre-wrap;">@historialContratos.OrderByDescending(c => c.FechaInicio).FirstOrDefault()?.Observaciones</p>
            </div>
        }
    }
    else
    {
        <div class="empty-state">
            <div class="message">No hay historial de contratos para este empleado</div>
        </div>
    }
</FormModal>

<!-- Modal de confirmaci√≥n -->
<FormModal @bind-IsVisible="showConfirmModal"
           Title="CONFIRMAR ACCI√ìN"
           Width="400px"
           ShowSaveButton="false"
           ShowCancelButton="false">
    <p>@confirmMessage</p>
    <div class="modal-actions">
        <button @onclick="() => showConfirmModal = false">CANCELAR</button>
        <button class="btn-danger" @onclick="ConfirmarAccion">CONFIRMAR</button>
    </div>
</FormModal>

@code {
    [Parameter] public int? EmpleadoIdParam { get; set; }
    
    private KeyboardHandler? keyboardHandler;
    private List<KeyboardHandler.KeyboardShortcut> shortcuts = new();
    
    private List<Contrato> contratos = new();
    private List<Contrato> todosContratos = new();
    private List<Contrato> contratosPorVencer = new();
    private List<Contrato> historialContratos = new();
    private List<Empleado> empleados = new();
    private List<Cargo> cargos = new();
    
    private Contrato? selectedContrato;
    private Contrato contratoEdit = new();
    private Empleado? empleadoSeleccionado;
    
    private bool isLoading;
    private bool showModal;
    private bool showHistorialModal;
    private bool showConfirmModal;
    private bool isSaving;
    private bool isEditing;
    
    private string? errorMessage;
    private string? successMessage;
    private string searchTerm = "";
    private string filtroEstado = "";
    private string filtroTipo = "";
    private string confirmMessage = "";
    
    private int totalContratos;
    private Action? confirmAction;
    
    private IBrowserFile? archivoSeleccionado;
    
    protected override async Task OnInitializedAsync()
    {
        if (!AuthService.IsAuthenticated)
        {
            Navigation.NavigateTo("/login");
            return;
        }
        
        ConfigurarAtajos();
        await CargarDatos();
        
        // Si hay un ID de empleado en la URL, filtrar por ese empleado
        if (EmpleadoIdParam.HasValue)
        {
            await FiltrarPorEmpleado(EmpleadoIdParam.Value);
        }
    }
    
    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            // Mostrar mensaje de √©xito si existe
            if (successMessage != null)
            {
                await Task.Delay(3000);
                successMessage = null;
                StateHasChanged();
            }
        }
    }
    
    private void ConfigurarAtajos()
    {
        shortcuts = new List<KeyboardHandler.KeyboardShortcut>
        {
            new() { Key = "F2", KeyDisplay = "F2", Description = "Buscar", Action = FocusBusqueda },
            new() { Key = "F3", KeyDisplay = "F3", Description = "Nuevo", Action = NuevoContrato },
            new() { Key = "F4", KeyDisplay = "F4", Description = "Editar", Action = EditarSeleccionado },
            new() { Key = "F5", KeyDisplay = "F5", Description = "Actualizar", Action = CargarContratos },
            new() { Key = "Escape", KeyDisplay = "ESC", Description = "Cerrar", Action = CerrarModal }
        };
    }
    
    private async Task CargarDatos()
    {
        isLoading = true;
        StateHasChanged();
        
        try
        {
            // Cargar contratos con sus relaciones
            var contratosTask = ContratoRepository.GetAllActiveAsync();
            var empleadosTask = EmpleadoRepository.GetAllActiveAsync();
            var cargosTask = CargoRepository.GetAllActiveAsync();
            
            await Task.WhenAll(contratosTask, empleadosTask, cargosTask);
            
            todosContratos = (await contratosTask).ToList();
            empleados = (await empleadosTask).ToList();
            cargos = (await cargosTask).ToList();
            
            // Cargar las relaciones manualmente
            foreach (var contrato in todosContratos)
            {
                contrato.Empleado = empleados.FirstOrDefault(e => e.Id == contrato.EmpleadoId);
                contrato.Cargo = cargos.FirstOrDefault(c => c.Id == contrato.CargoId);
            }
            
            contratos = todosContratos;
            totalContratos = contratos.Count;
            
            // Obtener contratos por vencer
            contratosPorVencer = (await ContratoRepository.GetContratosProximosAVencerAsync(30)).ToList();
            foreach (var contrato in contratosPorVencer)
            {
                contrato.Empleado = empleados.FirstOrDefault(e => e.Id == contrato.EmpleadoId);
            }
            
            Logger.LogInformation($"Cargados {contratos.Count} contratos, {contratosPorVencer.Count} por vencer");
        }
        catch (Exception ex)
        {
            Logger.LogError(ex, "Error al cargar datos de contratos");
            errorMessage = $"Error al cargar contratos: {ex.Message}";
        }
        finally
        {
            isLoading = false;
            StateHasChanged();
        }
    }
    
    private async Task CargarContratos()
    {
        await CargarDatos();
        successMessage = "Contratos actualizados correctamente";
        await Task.Delay(3000);
        successMessage = null;
        StateHasChanged();
    }
    
    private Task NuevoContrato()
    {
        contratoEdit = new Contrato
        {
            FechaInicio = DateTime.Today,
            TipoContrato = TipoContrato.Indefinido,
            Estado = EstadoContrato.Activo,
            Salario = 0
        };
        
        // Si hay un empleado seleccionado en el historial, pre-seleccionarlo
        if (empleadoSeleccionado != null)
        {
            contratoEdit.EmpleadoId = empleadoSeleccionado.Id;
        }
        
        archivoSeleccionado = null;
        isEditing = false;
        showModal = true;
        return Task.CompletedTask;
    }
    
    private void EditarContrato(Contrato contrato)
    {
        contratoEdit = new Contrato
        {
            Id = contrato.Id,
            EmpleadoId = contrato.EmpleadoId,
            TipoContrato = contrato.TipoContrato,
            FechaInicio = contrato.FechaInicio,
            FechaFin = contrato.FechaFin,
            Salario = contrato.Salario,
            CargoId = contrato.CargoId,
            Estado = contrato.Estado,
            ArchivoAdjuntoPath = contrato.ArchivoAdjuntoPath,
            Observaciones = contrato.Observaciones
        };
        
        archivoSeleccionado = null;
        isEditing = true;
        showModal = true;
    }
    
    private Task EditarSeleccionado()
    {
        if (selectedContrato != null)
        {
            EditarContrato(selectedContrato);
        }
        return Task.CompletedTask;
    }
    
    private void SelectContrato(Contrato contrato)
    {
        selectedContrato = contrato;
    }
    
    private async Task GuardarContrato()
    {
        try
        {
            // Validaciones
            if (contratoEdit.EmpleadoId <= 0)
            {
                errorMessage = "Debe seleccionar un empleado";
                return;
            }
            
            if (contratoEdit.CargoId <= 0)
            {
                errorMessage = "Debe seleccionar un cargo";
                return;
            }
            
            if (contratoEdit.Salario <= 0)
            {
                errorMessage = "El salario debe ser mayor a cero";
                return;
            }
            
            if (contratoEdit.FechaFin.HasValue && contratoEdit.FechaFin.Value < contratoEdit.FechaInicio)
            {
                errorMessage = "La fecha de fin debe ser posterior a la fecha de inicio";
                return;
            }
            
            isSaving = true;
            StateHasChanged();
            
            // Guardar archivo adjunto si existe
            if (archivoSeleccionado != null)
            {
                var buffer = new byte[archivoSeleccionado.Size];
                await archivoSeleccionado.OpenReadStream(maxAllowedSize: 10 * 1024 * 1024).ReadAsync(buffer);
                
                var result = await StorageService.SaveContratoArchivoAsync(
                    contratoEdit.Id > 0 ? contratoEdit.Id : (int)(DateTime.Now.Ticks % int.MaxValue),
                    buffer,
                    archivoSeleccionado.Name
                );
                
                if (result.IsSuccess)
                {
                    contratoEdit.ArchivoAdjuntoPath = result.Value;
                }
            }
            
            if (isEditing)
            {
                await ContratoRepository.UpdateAsync(contratoEdit);
                Logger.LogInformation($"Contrato {contratoEdit.Id} actualizado por usuario {AuthService.CurrentUser?.Username}");
                successMessage = "Contrato actualizado correctamente";
            }
            else
            {
                await ContratoRepository.AddAsync(contratoEdit);
                Logger.LogInformation($"Nuevo contrato creado para empleado {contratoEdit.EmpleadoId} por usuario {AuthService.CurrentUser?.Username}");
                successMessage = "Contrato creado correctamente";
            }
            
            await CargarDatos();
            CerrarModal();
            
            await Task.Delay(3000);
            successMessage = null;
            StateHasChanged();
        }
        catch (Exception ex)
        {
            Logger.LogError(ex, "Error al guardar contrato");
            errorMessage = $"Error al guardar: {ex.Message}";
        }
        finally
        {
            isSaving = false;
            StateHasChanged();
        }
    }
    
    private Task CerrarModal()
    {
        showModal = false;
        contratoEdit = new();
        archivoSeleccionado = null;
        isEditing = false;
        errorMessage = null;
        return Task.CompletedTask;
    }
    
    private async Task FocusBusqueda()
    {
        await JSRuntime.InvokeVoidAsync("focusElement", "searchInput");
    }
    
    private async Task OnSearchKeyUp(KeyboardEventArgs e)
    {
        if (e.Key == "Enter")
        {
            await Buscar();
        }
    }
    
    private Task Buscar()
    {
        ApplyFilters();
        return Task.CompletedTask;
    }
    
    private Task LimpiarBusqueda()
    {
        searchTerm = "";
        ApplyFilters();
        return Task.CompletedTask;
    }
    
    private Task Filtrar()
    {
        ApplyFilters();
        return Task.CompletedTask;
    }
    
    private void ApplyFilters()
    {
        contratos = todosContratos;
        
        // Filtro por b√∫squeda (empleado)
        if (!string.IsNullOrWhiteSpace(searchTerm))
        {
            var search = searchTerm.ToLower();
            contratos = contratos.Where(c => 
                (c.Empleado?.NombreCompleto?.ToLower().Contains(search) ?? false) ||
                (c.Empleado?.Cedula?.Contains(search) ?? false) ||
                (c.Empleado?.Codigo?.ToLower().Contains(search) ?? false)
            ).ToList();
        }
        
        // Filtro por estado
        if (!string.IsNullOrEmpty(filtroEstado) && int.TryParse(filtroEstado, out int estadoId))
        {
            contratos = contratos.Where(c => (int)c.Estado == estadoId).ToList();
        }
        
        // Filtro por tipo de contrato
        if (!string.IsNullOrEmpty(filtroTipo) && int.TryParse(filtroTipo, out int tipoId))
        {
            contratos = contratos.Where(c => (int)c.TipoContrato == tipoId).ToList();
        }
        
        totalContratos = contratos.Count;
        StateHasChanged();
    }
    
    private async Task FiltrarPorEmpleado(int empleadoId)
    {
        var empleado = empleados.FirstOrDefault(e => e.Id == empleadoId);
        if (empleado != null)
        {
            searchTerm = empleado.NombreCompleto ?? "";
            await Buscar();
        }
    }
    
    private async Task VerHistorial(Contrato contrato)
    {
        try
        {
            empleadoSeleccionado = contrato.Empleado;
            historialContratos = (await ContratoRepository.GetByEmpleadoIdAsync(contrato.EmpleadoId)).ToList();
            
            // Cargar relaciones
            foreach (var c in historialContratos)
            {
                c.Cargo = cargos.FirstOrDefault(cg => cg.Id == c.CargoId);
            }
            
            showHistorialModal = true;
        }
        catch (Exception ex)
        {
            Logger.LogError(ex, $"Error al cargar historial de contratos para empleado {contrato.EmpleadoId}");
            errorMessage = $"Error al cargar historial: {ex.Message}";
        }
    }
    
    private void EditarContratoFromHistorial(Contrato contrato)
    {
        showHistorialModal = false;
        EditarContrato(contrato);
    }
    
    private async Task DescargarAdjunto(Contrato contrato)
    {
        try
        {
            if (string.IsNullOrEmpty(contrato.ArchivoAdjuntoPath))
                return;
            
            var result = await StorageService.GetContratoArchivoAsync(contrato.Id);
            if (result.IsSuccess && result.Value != null)
            {
                var fileName = System.IO.Path.GetFileName(contrato.ArchivoAdjuntoPath);
                await JSRuntime.InvokeVoidAsync("downloadFile", fileName, Convert.ToBase64String(result.Value));
            }
        }
        catch (Exception ex)
        {
            Logger.LogError(ex, $"Error al descargar archivo adjunto del contrato {contrato.Id}");
            errorMessage = $"Error al descargar archivo: {ex.Message}";
        }
    }
    
    private void OnArchivoSelected(InputFileChangeEventArgs e)
    {
        archivoSeleccionado = e.File;
    }
    
    private string GetTipoContratoDisplay(TipoContrato tipo)
    {
        return tipo switch
        {
            TipoContrato.Indefinido => "Indefinido",
            TipoContrato.Fijo => "Fijo",
            TipoContrato.ObraLabor => "Obra o Labor",
            TipoContrato.PrestacionServicios => "Prestaci√≥n de Servicios",
            TipoContrato.Aprendizaje => "Aprendizaje",
            _ => tipo.ToString()
        };
    }
    
    private void ConfirmarAccion()
    {
        confirmAction?.Invoke();
        showConfirmModal = false;
    }
}
