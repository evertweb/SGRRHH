<UserControl x:Class="SGRRHH.WPF.Views.DashboardView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             mc:Ignorable="d" 
             d:DesignHeight="700" d:DesignWidth="1000"
             Background="#FAFAFA">
    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Banner de testing v1.0.8 -->
        <Border Grid.Row="0" Background="#E8F5E9" BorderBrush="#4CAF50" BorderThickness="2"
                CornerRadius="8" Padding="12,8" Margin="0,0,0,15">
            <TextBlock FontSize="14" Foreground="#2E7D32" FontWeight="SemiBold" TextAlignment="Center">
                <Run Text="âœ¨ Sistema de actualizaciones automÃ¡ticas activo - v1.0.8"/>
            </TextBlock>
        </Border>

        <!-- Encabezado con bienvenida y botÃ³n de refrescar -->
        <Grid Grid.Row="0" Margin="0,50,0,20">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <StackPanel Grid.Column="0">
                <TextBlock Text="{Binding WelcomeMessage}" FontSize="28" FontWeight="Bold" Foreground="#1565C0"/>
                <TextBlock FontSize="14" Foreground="#757575" Margin="0,5,0,0">
                    <Run Text="ðŸ“† "/>
                    <Run Text="{Binding CurrentDate, Mode=OneWay}"/>
                </TextBlock>
            </StackPanel>
            
            <Button Grid.Column="1" Content="ðŸ”„ Actualizar" 
                    Command="{Binding RefreshDataCommand}"
                    Background="#E3F2FD" Foreground="#1565C0" 
                    FontWeight="SemiBold" Padding="15,10" 
                    BorderThickness="0" Cursor="Hand"
                    ToolTip="Actualizar estadÃ­sticas"/>
        </Grid>
        
        <!-- Indicador de carga -->
        <Border Grid.Row="1" Background="#FFF8E1" Padding="15" Margin="0,0,0,15" CornerRadius="8"
                Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibilityConverter}}">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                <TextBlock Text="â³" FontSize="18" VerticalAlignment="Center" Margin="0,0,10,0"/>
                <TextBlock Text="Cargando estadÃ­sticas..." FontSize="14" Foreground="#F57C00" VerticalAlignment="Center"/>
            </StackPanel>
        </Border>

        <!-- Cards de estadÃ­sticas -->
        <Grid Grid.Row="2" Margin="0,0,0,30">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Total Empleados -->
            <Border Grid.Column="0" Background="#E3F2FD" CornerRadius="12" Padding="20" Margin="0,0,10,0"
                    BorderBrush="#90CAF9" BorderThickness="1">
                <Border.Effect>
                    <DropShadowEffect Color="#1565C0" BlurRadius="10" ShadowDepth="0" Opacity="0.1"/>
                </Border.Effect>
                <StackPanel>
                    <TextBlock Text="ðŸ‘¥ Total Empleados" FontSize="14" Foreground="#1565C0"/>
                    <TextBlock Text="{Binding TotalEmpleados}" FontSize="42" FontWeight="Bold" Foreground="#0D47A1" Margin="0,10,0,0"/>
                    <TextBlock Text="empleados activos" FontSize="11" Foreground="#64B5F6" Margin="0,5,0,0"/>
                </StackPanel>
            </Border>

            <!-- Proyectos Activos -->
            <Border Grid.Column="1" Background="#E8F5E9" CornerRadius="12" Padding="20" Margin="10,0"
                    BorderBrush="#A5D6A7" BorderThickness="1">
                <Border.Effect>
                    <DropShadowEffect Color="#2E7D32" BlurRadius="10" ShadowDepth="0" Opacity="0.1"/>
                </Border.Effect>
                <StackPanel>
                    <TextBlock Text="ðŸš€ Proyectos Activos" FontSize="14" Foreground="#2E7D32"/>
                    <TextBlock Text="{Binding ProyectosActivos}" FontSize="42" FontWeight="Bold" Foreground="#1B5E20" Margin="0,10,0,0"/>
                    <TextBlock Text="proyectos en curso" FontSize="11" Foreground="#81C784" Margin="0,5,0,0"/>
                </StackPanel>
            </Border>

            <!-- Presentes Hoy -->
            <Border Grid.Column="2" Background="#FFF3E0" CornerRadius="12" Padding="20" Margin="10,0"
                    BorderBrush="#FFCC80" BorderThickness="1">
                <Border.Effect>
                    <DropShadowEffect Color="#EF6C00" BlurRadius="10" ShadowDepth="0" Opacity="0.1"/>
                </Border.Effect>
                <StackPanel>
                    <TextBlock Text="ðŸ“… Registros Hoy" FontSize="14" Foreground="#EF6C00"/>
                    <TextBlock Text="{Binding EmpleadosPresentesHoy}" FontSize="42" FontWeight="Bold" Foreground="#E65100" Margin="0,10,0,0"/>
                    <TextBlock Text="con actividad registrada" FontSize="11" Foreground="#FFB74D" Margin="0,5,0,0"/>
                </StackPanel>
            </Border>

            <!-- Alertas -->
            <Border Grid.Column="3" Background="#FFEBEE" CornerRadius="12" Padding="20" Margin="10,0,0,0"
                    BorderBrush="#EF9A9A" BorderThickness="1">
                <Border.Effect>
                    <DropShadowEffect Color="#C62828" BlurRadius="10" ShadowDepth="0" Opacity="0.1"/>
                </Border.Effect>
                <StackPanel>
                    <TextBlock Text="âš ï¸ Alertas" FontSize="14" Foreground="#C62828"/>
                    <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                        <TextBlock Text="{Binding PermisosPendientes}" FontSize="24" FontWeight="Bold" Foreground="#B71C1C"/>
                        <TextBlock Text=" permisos pendientes" VerticalAlignment="Bottom" Margin="5,0,0,4" FontSize="11" Foreground="#EF5350"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,5,0,0">
                        <TextBlock Text="{Binding ContratosPorVencer}" FontSize="24" FontWeight="Bold" Foreground="#B71C1C"/>
                        <TextBlock Text=" contratos por vencer" VerticalAlignment="Bottom" Margin="5,0,0,4" FontSize="11" Foreground="#EF5350"/>
                    </StackPanel>
                </StackPanel>
            </Border>
        </Grid>

        <!-- SecciÃ³n de CumpleaÃ±os y Aniversarios -->
        <Grid Grid.Row="3" Margin="0,0,0,20">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            
            <!-- CumpleaÃ±os PrÃ³ximos -->
            <Border Grid.Column="0" Background="White" BorderBrush="#E0E0E0" BorderThickness="1"
                    CornerRadius="12" Padding="20" Margin="0,0,10,0">
                <Border.Effect>
                    <DropShadowEffect Color="Gray" BlurRadius="8" ShadowDepth="0" Opacity="0.1"/>
                </Border.Effect>
                <StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,15">
                        <TextBlock Text="ðŸŽ‚" FontSize="20" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <TextBlock Text="CumpleaÃ±os PrÃ³ximos (7 dÃ­as)" FontSize="16" FontWeight="SemiBold" Foreground="#E91E63"/>
                    </StackPanel>
                    
                    <!-- Lista de cumpleaÃ±os -->
                    <ItemsControl ItemsSource="{Binding CumpleaniosProximos}"
                                  Visibility="{Binding HayCumpleanios, Converter={StaticResource BoolToVisibilityConverter}}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Background="#FCE4EC" CornerRadius="8" Padding="12" Margin="0,0,0,8">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <StackPanel Grid.Column="0">
                                            <TextBlock Text="{Binding NombreCompleto}" FontWeight="SemiBold" FontSize="13"/>
                                            <TextBlock Text="{Binding Cargo}" FontSize="11" Foreground="#757575"/>
                                            <TextBlock FontSize="11" Foreground="#E91E63" Margin="0,3,0,0">
                                                <Run Text="Cumple "/>
                                                <Run Text="{Binding EdadCumplir, Mode=OneWay}"/>
                                                <Run Text=" aÃ±os"/>
                                            </TextBlock>
                                        </StackPanel>
                                        <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                            <TextBlock Text="{Binding DiasTexto}" FontWeight="SemiBold" FontSize="12"
                                                       Foreground="#C2185B" HorizontalAlignment="Right"/>
                                            <TextBlock Text="{Binding FechaCumple, StringFormat='dd/MM'}" FontSize="11"
                                                       Foreground="#757575" HorizontalAlignment="Right"/>
                                        </StackPanel>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                    
                    <!-- Mensaje si no hay cumpleaÃ±os -->
                    <Border Background="#F5F5F5" CornerRadius="8" Padding="15"
                            Visibility="{Binding HayCumpleanios, Converter={StaticResource InverseBoolToVisibilityConverter}}">
                        <TextBlock Text="No hay cumpleaÃ±os en los prÃ³ximos 7 dÃ­as"
                                   FontSize="12" Foreground="#9E9E9E" HorizontalAlignment="Center"/>
                    </Border>
                </StackPanel>
            </Border>
            
            <!-- Aniversarios Laborales -->
            <Border Grid.Column="1" Background="White" BorderBrush="#E0E0E0" BorderThickness="1"
                    CornerRadius="12" Padding="20" Margin="10,0,0,0">
                <Border.Effect>
                    <DropShadowEffect Color="Gray" BlurRadius="8" ShadowDepth="0" Opacity="0.1"/>
                </Border.Effect>
                <StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,15">
                        <TextBlock Text="ðŸ†" FontSize="20" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <TextBlock Text="Aniversarios Laborales (7 dÃ­as)" FontSize="16" FontWeight="SemiBold" Foreground="#FF9800"/>
                    </StackPanel>
                    
                    <!-- Lista de aniversarios -->
                    <ItemsControl ItemsSource="{Binding AniversariosProximos}"
                                  Visibility="{Binding HayAniversarios, Converter={StaticResource BoolToVisibilityConverter}}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Background="#FFF3E0" CornerRadius="8" Padding="12" Margin="0,0,0,8">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <StackPanel Grid.Column="0">
                                            <TextBlock Text="{Binding NombreCompleto}" FontWeight="SemiBold" FontSize="13"/>
                                            <TextBlock Text="{Binding Cargo}" FontSize="11" Foreground="#757575"/>
                                            <TextBlock FontSize="11" Foreground="#EF6C00" Margin="0,3,0,0">
                                                <Run Text="Cumple "/>
                                                <Run Text="{Binding AnosTexto, Mode=OneWay}"/>
                                                <Run Text=" en la empresa"/>
                                            </TextBlock>
                                        </StackPanel>
                                        <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                            <TextBlock Text="{Binding DiasTexto}" FontWeight="SemiBold" FontSize="12"
                                                       Foreground="#E65100" HorizontalAlignment="Right"/>
                                            <TextBlock Text="{Binding FechaAniversario, StringFormat='dd/MM'}" FontSize="11"
                                                       Foreground="#757575" HorizontalAlignment="Right"/>
                                        </StackPanel>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                    
                    <!-- Mensaje si no hay aniversarios -->
                    <Border Background="#F5F5F5" CornerRadius="8" Padding="15"
                            Visibility="{Binding HayAniversarios, Converter={StaticResource InverseBoolToVisibilityConverter}}">
                        <TextBlock Text="No hay aniversarios en los prÃ³ximos 7 dÃ­as"
                                   FontSize="12" Foreground="#9E9E9E" HorizontalAlignment="Center"/>
                    </Border>
                </StackPanel>
            </Border>
        </Grid>

        <!-- SecciÃ³n inferior con accesos rÃ¡pidos y actividad -->
        <Grid Grid.Row="4">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <Border Grid.Column="0" Background="White" BorderBrush="#E0E0E0" BorderThickness="1"
                    CornerRadius="12" Padding="25" Margin="0,0,10,0">
                <Border.Effect>
                    <DropShadowEffect Color="Gray" BlurRadius="8" ShadowDepth="0" Opacity="0.1"/>
                </Border.Effect>
                <StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,20">
                        <TextBlock Text="âš¡" FontSize="20" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <TextBlock Text="Accesos RÃ¡pidos" FontSize="18" FontWeight="SemiBold"/>
                    </StackPanel>
                    <WrapPanel>
                        <Button Width="170" Height="45" Margin="0,0,10,10"
                                Command="{Binding NavigateToControlDiarioCommand}"
                                Background="#1E88E5" Foreground="White" BorderThickness="0"
                                FontWeight="SemiBold" Cursor="Hand"
                                ToolTip="Ir a registrar actividades del dÃ­a">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="ðŸ“…" FontSize="16" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                <TextBlock Text="Registrar Actividad" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                        
                        <Button Width="155" Height="45" Margin="0,0,10,10"
                                Command="{Binding NavigateToNewEmpleadoCommand}"
                                Background="#43A047" Foreground="White" BorderThickness="0"
                                FontWeight="SemiBold" Cursor="Hand"
                                ToolTip="Registrar un nuevo empleado">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="âž•" FontSize="16" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                <TextBlock Text="Nuevo Empleado" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                        
                        <Button Width="155" Height="45" Margin="0,0,10,10"
                                Command="{Binding NavigateToPermisosCommand}"
                                Background="#FB8C00" Foreground="White" BorderThickness="0"
                                FontWeight="SemiBold" Cursor="Hand"
                                ToolTip="Ir a gestiÃ³n de permisos">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="ðŸ“" FontSize="16" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                <TextBlock Text="Solicitar Permiso" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                    </WrapPanel>
                </StackPanel>
            </Border>

            <Border Grid.Column="1" Background="White" BorderBrush="#E0E0E0" BorderThickness="1"
                    CornerRadius="12" Padding="25" Margin="10,0,0,0">
                <Border.Effect>
                    <DropShadowEffect Color="Gray" BlurRadius="8" ShadowDepth="0" Opacity="0.1"/>
                </Border.Effect>
                <StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,15">
                        <TextBlock Text="ðŸ“Š" FontSize="20" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <TextBlock Text="Empleados por Departamento" FontSize="18" FontWeight="SemiBold"/>
                    </StackPanel>
                    
                    <!-- GrÃ¡fico de barras horizontales -->
                    <ItemsControl ItemsSource="{Binding EmpleadosPorDepartamento}"
                                  Visibility="{Binding HayEstadisticasDepartamento, Converter={StaticResource BoolToVisibilityConverter}}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Grid Margin="0,0,0,8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="100"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="45"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <!-- Nombre del departamento -->
                                    <TextBlock Grid.Column="0" Text="{Binding Etiqueta}"
                                               FontSize="12" VerticalAlignment="Center"
                                               TextTrimming="CharacterEllipsis" ToolTip="{Binding Etiqueta}"/>
                                    
                                    <!-- Barra de progreso visual -->
                                    <Grid Grid.Column="1" Margin="10,0" VerticalAlignment="Center">
                                        <Border Background="#E0E0E0" CornerRadius="4" Height="22"/>
                                        <Border CornerRadius="4" Height="22" HorizontalAlignment="Left"
                                                Background="{Binding Color, Converter={StaticResource HexToColorConverter}}">
                                            <Border.Width>
                                                <MultiBinding Converter="{StaticResource PercentToWidthConverter}" Mode="OneWay">
                                                    <Binding Path="Porcentaje" Mode="OneWay"/>
                                                    <Binding Path="ActualWidth" RelativeSource="{RelativeSource AncestorType=Grid}" Mode="OneWay"/>
                                                </MultiBinding>
                                            </Border.Width>
                                        </Border>
                                    </Grid>
                                    
                                    <!-- Cantidad -->
                                    <StackPanel Grid.Column="2" Orientation="Horizontal"
                                                HorizontalAlignment="Right" VerticalAlignment="Center">
                                        <TextBlock Text="{Binding Cantidad}" FontWeight="Bold" FontSize="13"/>
                                        <TextBlock Text=" (" FontSize="11" Foreground="#757575" VerticalAlignment="Center"/>
                                        <TextBlock Text="{Binding Porcentaje, StringFormat='{}{0:0}%'}"
                                                   FontSize="11" Foreground="#757575" VerticalAlignment="Center"/>
                                        <TextBlock Text=")" FontSize="11" Foreground="#757575" VerticalAlignment="Center"/>
                                    </StackPanel>
                                </Grid>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                    
                    <!-- Mensaje si no hay datos -->
                    <Border Background="#F5F5F5" CornerRadius="8" Padding="15"
                            Visibility="{Binding HayEstadisticasDepartamento, Converter={StaticResource InverseBoolToVisibilityConverter}}">
                        <TextBlock Text="No hay datos de empleados disponibles"
                                   FontSize="12" Foreground="#9E9E9E" HorizontalAlignment="Center"/>
                    </Border>
                </StackPanel>
            </Border>
        </Grid>
    </Grid>
</UserControl>
