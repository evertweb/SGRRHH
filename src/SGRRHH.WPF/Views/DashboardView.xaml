<UserControl x:Class="SGRRHH.WPF.Views.DashboardView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             mc:Ignorable="d" 
             d:DesignHeight="700" d:DesignWidth="1000"
             Background="{StaticResource BackgroundBrush}">
    <Grid Margin="{StaticResource StandardMargin}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Banner de testing v1.0.9 -->
        <Border Grid.Row="0" Style="{StaticResource InfoPanel}" Margin="0,0,0,15">
            <TextBlock FontSize="14" Foreground="{StaticResource PrimaryDarkBrush}" FontWeight="SemiBold" TextAlignment="Center">
                <Run Text="âœ… Sistema de actualizaciones corregido - v1.0.9"/>
            </TextBlock>
        </Border>

        <!-- Encabezado con bienvenida y botÃ³n de refrescar -->
        <Grid Grid.Row="0" Margin="0,50,0,20">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <StackPanel Grid.Column="0">
                <TextBlock Text="{Binding WelcomeMessage}" FontSize="28" FontWeight="Bold" Foreground="{StaticResource PrimaryDarkBrush}"/>
                <TextBlock FontSize="14" Foreground="{StaticResource TextTertiaryBrush}" Margin="0,5,0,0">
                    <Run Text="ðŸ“† "/>
                    <Run Text="{Binding CurrentDate, Mode=OneWay}"/>
                </TextBlock>
            </StackPanel>
            
            <Button Grid.Column="1" Content="ðŸ”„ Actualizar" 
                    Command="{Binding RefreshDataCommand}"
                    Background="{StaticResource PrimaryLightBrush}" Foreground="{StaticResource PrimaryDarkBrush}" 
                    FontWeight="SemiBold" Padding="15,10" 
                    BorderThickness="0" Cursor="Hand"
                    ToolTip="Actualizar estadÃ­sticas"/>
        </Grid>
        
        <!-- Indicador de carga -->
        <Border Grid.Row="1" Style="{StaticResource LoadingPanel}" Margin="0,0,0,15"
                Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibilityConverter}}">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                <TextBlock Text="â³" FontSize="18" VerticalAlignment="Center" Margin="0,0,10,0"/>
                <TextBlock Text="Cargando estadÃ­sticas..." FontSize="14" Foreground="{StaticResource WarningBrush}" VerticalAlignment="Center"/>
            </StackPanel>
        </Border>

        <!-- Cards de estadÃ­sticas -->
        <Grid Grid.Row="2" Margin="0,0,0,30">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Total Empleados -->
            <Border Grid.Column="0" Style="{StaticResource StatCardBlue}" Margin="0,0,10,0">
                <StackPanel>
                    <TextBlock Text="ðŸ‘¥ Total Empleados" Style="{StaticResource StatLabelBlue}"/>
                    <TextBlock Text="{Binding TotalEmpleados}" Style="{StaticResource StatNumberBlue}" Margin="0,10,0,0"/>
                    <TextBlock Text="empleados activos" Style="{StaticResource StatSubtextBlue}"/>
                </StackPanel>
            </Border>

            <!-- Proyectos Activos -->
            <Border Grid.Column="1" Style="{StaticResource StatCardGreen}" Margin="10,0">
                <StackPanel>
                    <TextBlock Text="ðŸš€ Proyectos Activos" Style="{StaticResource StatLabelGreen}"/>
                    <TextBlock Text="{Binding ProyectosActivos}" Style="{StaticResource StatNumberGreen}" Margin="0,10,0,0"/>
                    <TextBlock Text="proyectos en curso" Style="{StaticResource StatSubtextGreen}"/>
                </StackPanel>
            </Border>

            <!-- Presentes Hoy -->
            <Border Grid.Column="2" Style="{StaticResource StatCardOrange}" Margin="10,0">
                <StackPanel>
                    <TextBlock Text="ðŸ“… Registros Hoy" Style="{StaticResource StatLabelOrange}"/>
                    <TextBlock Text="{Binding EmpleadosPresentesHoy}" Style="{StaticResource StatNumberOrange}" Margin="0,10,0,0"/>
                    <TextBlock Text="con actividad registrada" Style="{StaticResource StatSubtextOrange}"/>
                </StackPanel>
            </Border>

            <!-- Alertas -->
            <Border Grid.Column="3" Style="{StaticResource StatCardRed}" Margin="10,0,0,0">
                <StackPanel>
                    <TextBlock Text="âš ï¸ Alertas" Style="{StaticResource StatLabelRed}"/>
                    <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                        <TextBlock Text="{Binding PermisosPendientes}" Style="{StaticResource StatNumberMedium}" Foreground="{StaticResource DangerDeepBrush}"/>
                        <TextBlock Text=" permisos pendientes" VerticalAlignment="Bottom" Margin="5,0,0,4" Style="{StaticResource StatSubtextRed}"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,5,0,0">
                        <TextBlock Text="{Binding ContratosPorVencer}" Style="{StaticResource StatNumberMedium}" Foreground="{StaticResource DangerDeepBrush}"/>
                        <TextBlock Text=" contratos por vencer" VerticalAlignment="Bottom" Margin="5,0,0,4" Style="{StaticResource StatSubtextRed}"/>
                    </StackPanel>
                </StackPanel>
            </Border>
        </Grid>

        <!-- SecciÃ³n de CumpleaÃ±os y Aniversarios -->
        <Grid Grid.Row="3" Margin="0,0,0,20">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            
            <!-- CumpleaÃ±os PrÃ³ximos -->
            <Border Grid.Column="0" Style="{StaticResource Card}" Margin="0,0,10,0">
                <StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,15">
                        <TextBlock Text="ðŸŽ‚" FontSize="20" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <TextBlock Text="CumpleaÃ±os PrÃ³ximos (7 dÃ­as)" Style="{StaticResource CardTitle}" Foreground="{StaticResource PinkBrush}"/>
                    </StackPanel>
                    
                    <!-- Lista de cumpleaÃ±os -->
                    <ItemsControl ItemsSource="{Binding CumpleaniosProximos}"
                                  Visibility="{Binding HayCumpleanios, Converter={StaticResource BoolToVisibilityConverter}}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Background="{StaticResource PinkLightBrush}" CornerRadius="{StaticResource StandardRadius}" Padding="12" Margin="0,0,0,8">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <StackPanel Grid.Column="0">
                                            <TextBlock Text="{Binding NombreCompleto}" FontWeight="SemiBold" FontSize="13"/>
                                            <TextBlock Text="{Binding Cargo}" Style="{StaticResource SmallText}"/>
                                            <TextBlock FontSize="11" Foreground="{StaticResource PinkBrush}" Margin="0,3,0,0">
                                                <Run Text="Cumple "/>
                                                <Run Text="{Binding EdadCumplir, Mode=OneWay}"/>
                                                <Run Text=" aÃ±os"/>
                                            </TextBlock>
                                        </StackPanel>
                                        <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                            <TextBlock Text="{Binding DiasTexto}" FontWeight="SemiBold" FontSize="12"
                                                       Foreground="{StaticResource PinkDarkBrush}" HorizontalAlignment="Right"/>
                                            <TextBlock Text="{Binding FechaCumple, StringFormat='dd/MM'}" Style="{StaticResource SmallText}"
                                                       HorizontalAlignment="Right"/>
                                        </StackPanel>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                    
                    <!-- Mensaje si no hay cumpleaÃ±os -->
                    <Border Background="{StaticResource BorderLightBrush}" CornerRadius="{StaticResource StandardRadius}" Padding="15"
                            Visibility="{Binding HayCumpleanios, Converter={StaticResource InverseBoolToVisibilityConverter}}">
                        <TextBlock Text="No hay cumpleaÃ±os en los prÃ³ximos 7 dÃ­as"
                                   Style="{StaticResource CaptionText}" HorizontalAlignment="Center"/>
                    </Border>
                </StackPanel>
            </Border>
            
            <!-- Aniversarios Laborales -->
            <Border Grid.Column="1" Style="{StaticResource Card}" Margin="10,0,0,0">
                <StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,15">
                        <TextBlock Text="ðŸ†" FontSize="20" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <TextBlock Text="Aniversarios Laborales (7 dÃ­as)" Style="{StaticResource CardTitle}" Foreground="{StaticResource OrangeBrush}"/>
                    </StackPanel>
                    
                    <!-- Lista de aniversarios -->
                    <ItemsControl ItemsSource="{Binding AniversariosProximos}"
                                  Visibility="{Binding HayAniversarios, Converter={StaticResource BoolToVisibilityConverter}}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Background="{StaticResource WarningLightBrush}" CornerRadius="{StaticResource StandardRadius}" Padding="12" Margin="0,0,0,8">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <StackPanel Grid.Column="0">
                                            <TextBlock Text="{Binding NombreCompleto}" FontWeight="SemiBold" FontSize="13"/>
                                            <TextBlock Text="{Binding Cargo}" Style="{StaticResource SmallText}"/>
                                            <TextBlock FontSize="11" Foreground="{StaticResource WarningDarkBrush}" Margin="0,3,0,0">
                                                <Run Text="Cumple "/>
                                                <Run Text="{Binding AnosTexto, Mode=OneWay}"/>
                                                <Run Text=" en la empresa"/>
                                            </TextBlock>
                                        </StackPanel>
                                        <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                            <TextBlock Text="{Binding DiasTexto}" FontWeight="SemiBold" FontSize="12"
                                                       Foreground="{StaticResource WarningDarkerBrush}" HorizontalAlignment="Right"/>
                                            <TextBlock Text="{Binding FechaAniversario, StringFormat='dd/MM'}" Style="{StaticResource SmallText}"
                                                       HorizontalAlignment="Right"/>
                                        </StackPanel>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                    
                    <!-- Mensaje si no hay aniversarios -->
                    <Border Background="{StaticResource BorderLightBrush}" CornerRadius="{StaticResource StandardRadius}" Padding="15"
                            Visibility="{Binding HayAniversarios, Converter={StaticResource InverseBoolToVisibilityConverter}}">
                        <TextBlock Text="No hay aniversarios en los prÃ³ximos 7 dÃ­as"
                                   Style="{StaticResource CaptionText}" HorizontalAlignment="Center"/>
                    </Border>
                </StackPanel>
            </Border>
        </Grid>

        <!-- SecciÃ³n inferior con accesos rÃ¡pidos y actividad -->
        <Grid Grid.Row="4">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <Border Grid.Column="0" Style="{StaticResource Card}" Padding="25" Margin="0,0,10,0">
                <StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,20">
                        <TextBlock Text="âš¡" FontSize="20" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <TextBlock Text="Accesos RÃ¡pidos" Style="{StaticResource SectionTitle}"/>
                    </StackPanel>
                    <WrapPanel>
                        <Button Width="170" Height="45" Margin="0,0,10,10"
                                Command="{Binding NavigateToControlDiarioCommand}"
                                Style="{StaticResource PrimaryButton}"
                                ToolTip="Ir a registrar actividades del dÃ­a">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="ðŸ“…" FontSize="16" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                <TextBlock Text="Registrar Actividad" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                        
                        <Button Width="155" Height="45" Margin="0,0,10,10"
                                Command="{Binding NavigateToNewEmpleadoCommand}"
                                Style="{StaticResource SuccessButton}"
                                ToolTip="Registrar un nuevo empleado">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="âž•" FontSize="16" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                <TextBlock Text="Nuevo Empleado" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                        
                        <Button Width="155" Height="45" Margin="0,0,10,10"
                                Command="{Binding NavigateToPermisosCommand}"
                                Style="{StaticResource WarningButton}"
                                ToolTip="Ir a gestiÃ³n de permisos">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="ðŸ“" FontSize="16" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                <TextBlock Text="Solicitar Permiso" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                    </WrapPanel>
                </StackPanel>
            </Border>

            <Border Grid.Column="1" Style="{StaticResource Card}" Padding="25" Margin="10,0,0,0">
                <StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,15">
                        <TextBlock Text="ðŸ“Š" FontSize="20" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <TextBlock Text="Empleados por Departamento" Style="{StaticResource SectionTitle}"/>
                    </StackPanel>
                    
                    <!-- GrÃ¡fico de barras horizontales -->
                    <ItemsControl ItemsSource="{Binding EmpleadosPorDepartamento}"
                                  Visibility="{Binding HayEstadisticasDepartamento, Converter={StaticResource BoolToVisibilityConverter}}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Grid Margin="0,0,0,8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="100"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="45"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <!-- Nombre del departamento -->
                                    <TextBlock Grid.Column="0" Text="{Binding Etiqueta}"
                                               FontSize="12" VerticalAlignment="Center"
                                               TextTrimming="CharacterEllipsis" ToolTip="{Binding Etiqueta}"/>
                                    
                                    <!-- Barra de progreso visual -->
                                    <Grid Grid.Column="1" Margin="10,0" VerticalAlignment="Center">
                                        <Border Background="{StaticResource BorderBrush}" CornerRadius="4" Height="22"/>
                                        <Border CornerRadius="4" Height="22" HorizontalAlignment="Left"
                                                Background="{Binding Color, Converter={StaticResource HexToColorConverter}}">
                                            <Border.Width>
                                                <MultiBinding Converter="{StaticResource PercentToWidthConverter}" Mode="OneWay">
                                                    <Binding Path="Porcentaje" Mode="OneWay"/>
                                                    <Binding Path="ActualWidth" RelativeSource="{RelativeSource AncestorType=Grid}" Mode="OneWay"/>
                                                </MultiBinding>
                                            </Border.Width>
                                        </Border>
                                    </Grid>
                                    
                                    <!-- Cantidad -->
                                    <StackPanel Grid.Column="2" Orientation="Horizontal"
                                                HorizontalAlignment="Right" VerticalAlignment="Center">
                                        <TextBlock Text="{Binding Cantidad}" FontWeight="Bold" FontSize="13"/>
                                        <TextBlock Text=" (" Style="{StaticResource SmallText}" VerticalAlignment="Center"/>
                                        <TextBlock Text="{Binding Porcentaje, StringFormat='{}{0:0}%'}"
                                                   Style="{StaticResource SmallText}" VerticalAlignment="Center"/>
                                        <TextBlock Text=")" Style="{StaticResource SmallText}" VerticalAlignment="Center"/>
                                    </StackPanel>
                                </Grid>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                    
                    <!-- Mensaje si no hay datos -->
                    <Border Background="{StaticResource BorderLightBrush}" CornerRadius="{StaticResource StandardRadius}" Padding="15"
                            Visibility="{Binding HayEstadisticasDepartamento, Converter={StaticResource InverseBoolToVisibilityConverter}}">
                        <TextBlock Text="No hay datos de empleados disponibles"
                                   Style="{StaticResource CaptionText}" HorizontalAlignment="Center"/>
                    </Border>
                </StackPanel>
            </Border>
        </Grid>
    </Grid>
</UserControl>
