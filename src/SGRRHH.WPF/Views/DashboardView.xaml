<UserControl x:Class="SGRRHH.WPF.Views.DashboardView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:controls="clr-namespace:SGRRHH.WPF.Controls"
             mc:Ignorable="d" 
             d:DesignHeight="700" d:DesignWidth="1000"
             Background="{StaticResource ControlBrush}">
    
    <Grid Margin="5">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>  <!-- Header/Bienvenida -->
            <RowDefinition Height="Auto"/>  <!-- Estadísticas principales -->
            <RowDefinition Height="Auto"/>  <!-- Alertas -->
            <RowDefinition Height="*"/>     <!-- Sección inferior -->
        </Grid.RowDefinitions>

        <!-- ================================================== -->
        <!-- 1. HEADER / BIENVENIDA -->
        <!-- ================================================== -->
        <Border Grid.Row="0" BorderThickness="1" BorderBrush="{StaticResource ShadowBrush}" Background="{StaticResource WhiteBrush}" Margin="0,0,0,5">
            <Border BorderThickness="1" BorderBrush="#DFDFDF" Padding="10">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <!-- Mensaje de bienvenida -->
                    <StackPanel Grid.Column="0">
                        <TextBlock Text="{Binding WelcomeMessage}" FontFamily="Tahoma" FontSize="14" 
                                   FontWeight="Bold" Foreground="#000080"/>
                        <TextBlock Text="{Binding CurrentDate}" FontFamily="Tahoma" FontSize="10" 
                                   Foreground="#404040" Margin="0,3,0,0"/>
                    </StackPanel>
                    
                    <!-- Indicador de carga -->
                    <TextBlock Grid.Column="1" Text="[Cargando datos...]" FontFamily="Tahoma" FontSize="10"
                               Foreground="#808080" FontStyle="Italic" VerticalAlignment="Center" Margin="0,0,10,0"
                               Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibilityConverter}}"/>
                    
                    <controls:LegacyAsyncButton Content="Actualizar" 
                                                 Command="{Binding RefreshDataCommand}"
                                                 IsLoading="{Binding IsLoading}"/>
                </Grid>
            </Border>
        </Border>

        <!-- ================================================== -->
        <!-- 2. ESTADÍSTICAS PRINCIPALES (Tabla tipo grid) -->
        <!-- ================================================== -->
        <Border Grid.Row="1" BorderThickness="1" BorderBrush="{StaticResource ShadowBrush}" Margin="0,0,0,5">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>  <!-- Header -->
                    <RowDefinition Height="Auto"/>  <!-- Contenido -->
                </Grid.RowDefinitions>
                
                <!-- Header de la sección -->
                <Border Grid.Row="0" Background="{StaticResource TitleBarBrush}" Padding="{StaticResource SectionHeaderPadding}">
                    <TextBlock Text="--- RESUMEN DEL SISTEMA ---" FontFamily="Tahoma" FontSize="11" 
                               FontWeight="Bold" Foreground="White" HorizontalAlignment="Center"/>
                </Border>
                
                <!-- Grid de estadísticas -->
                <Grid Grid.Row="1" Background="{StaticResource WhiteBrush}">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    
                    <!-- Total Empleados -->
                    <Border Grid.Column="0" BorderThickness="0,0,1,0" BorderBrush="{StaticResource ShadowBrush}" Padding="15,10">
                        <StackPanel HorizontalAlignment="Center">
                            <TextBlock Text="EMPLEADOS" FontFamily="Tahoma" FontSize="9" Foreground="#808080" 
                                       HorizontalAlignment="Center" FontWeight="Bold"/>
                            <TextBlock Text="{Binding TotalEmpleados}" FontFamily="Courier New" FontSize="28" 
                                       FontWeight="Bold" Foreground="Black" HorizontalAlignment="Center" Margin="0,5,0,0"/>
                            <TextBlock Text="activos" FontFamily="Tahoma" FontSize="9" Foreground="#808080" 
                                       HorizontalAlignment="Center"/>
                        </StackPanel>
                    </Border>
                    
                    <!-- Proyectos Activos -->
                    <Border Grid.Column="1" BorderThickness="0,0,1,0" BorderBrush="{StaticResource ShadowBrush}" Padding="15,10">
                        <StackPanel HorizontalAlignment="Center">
                            <TextBlock Text="PROYECTOS" FontFamily="Tahoma" FontSize="9" Foreground="#808080" 
                                       HorizontalAlignment="Center" FontWeight="Bold"/>
                            <TextBlock Text="{Binding ProyectosActivos}" FontFamily="Courier New" FontSize="28" 
                                       FontWeight="Bold" Foreground="Black" HorizontalAlignment="Center" Margin="0,5,0,0"/>
                            <TextBlock Text="en curso" FontFamily="Tahoma" FontSize="9" Foreground="#808080" 
                                       HorizontalAlignment="Center"/>
                        </StackPanel>
                    </Border>
                    
                    <!-- Registros Hoy -->
                    <Border Grid.Column="2" BorderThickness="0,0,1,0" BorderBrush="{StaticResource ShadowBrush}" Padding="15,10">
                        <StackPanel HorizontalAlignment="Center">
                            <TextBlock Text="REGISTROS HOY" FontFamily="Tahoma" FontSize="9" Foreground="#808080" 
                                       HorizontalAlignment="Center" FontWeight="Bold"/>
                            <TextBlock Text="{Binding EmpleadosPresentesHoy}" FontFamily="Courier New" FontSize="28" 
                                       FontWeight="Bold" Foreground="Black" HorizontalAlignment="Center" Margin="0,5,0,0"/>
                            <TextBlock Text="con actividad" FontFamily="Tahoma" FontSize="9" Foreground="#808080" 
                                       HorizontalAlignment="Center"/>
                        </StackPanel>
                    </Border>
                    
                    <!-- Alertas -->
                    <Border Grid.Column="3" Padding="15,10" Background="{StaticResource WhiteBrush}">
                        <StackPanel HorizontalAlignment="Center">
                            <TextBlock Text="[!] ALERTAS" FontFamily="Tahoma" FontSize="9" Foreground="Black" 
                                       HorizontalAlignment="Center" FontWeight="Bold"/>
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,5,0,0">
                                <TextBlock Text="{Binding PermisosPendientes}" FontFamily="Courier New" FontSize="14" 
                                           FontWeight="Bold" Foreground="Black"/>
                                <TextBlock Text=" permisos" FontFamily="Tahoma" FontSize="9" Foreground="#808080" 
                                           VerticalAlignment="Bottom" Margin="0,0,0,2"/>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,2,0,0">
                                <TextBlock Text="{Binding ContratosPorVencer}" FontFamily="Courier New" FontSize="14" 
                                           FontWeight="Bold" Foreground="Black"/>
                                <TextBlock Text=" contratos" FontFamily="Tahoma" FontSize="9" Foreground="#808080" 
                                           VerticalAlignment="Bottom" Margin="0,0,0,2"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>
                </Grid>
            </Grid>
        </Border>

        <!-- ================================================== -->
        <!-- 3. ACCESOS RÁPIDOS -->
        <!-- ================================================== -->
        <Border Grid.Row="2" BorderThickness="1" BorderBrush="{StaticResource ShadowBrush}" Margin="0,0,0,5">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <Border Grid.Row="0" Background="#E0E0E0" Padding="5,2">
                    <TextBlock Text="ACCESOS RAPIDOS" FontFamily="Tahoma" FontSize="10" FontWeight="Bold" Foreground="#404040"/>
                </Border>
                
                <StackPanel Grid.Row="1" Orientation="Horizontal" Background="{StaticResource WhiteBrush}" Margin="{StaticResource FormFieldPadding}">
                    <Button Content="Registrar Actividad" 
                            Command="{Binding NavigateToControlDiarioCommand}"
                            Style="{StaticResource LegacyButtonStyle}"
                            Padding="15,5" Margin="0,0,10,0"/>
                    
                    <Button Content="+ Nuevo Empleado" 
                            Command="{Binding NavigateToNewEmpleadoCommand}"
                            Style="{StaticResource LegacyButtonStyle}"
                            Padding="15,5" Margin="0,0,10,0"/>
                    
                    <Button Content="Solicitar Permiso" 
                            Command="{Binding NavigateToPermisosCommand}"
                            Style="{StaticResource LegacyButtonStyle}"
                            Padding="15,5"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- ================================================== -->
        <!-- 4. SECCIÓN INFERIOR: Cumpleaños, Aniversarios, Stats -->
        <!-- ================================================== -->
        <Grid Grid.Row="3">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Panel: Cumpleaños Próximos -->
            <Border Grid.Column="0" BorderThickness="1" BorderBrush="{StaticResource ShadowBrush}" Margin="0,0,3,0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    
                    <Border Grid.Row="0" Background="#C0C0C0" Padding="5,3">
                        <TextBlock Text="CUMPLEAÑOS (7 días)" FontFamily="Tahoma" FontSize="10" 
                                   FontWeight="Bold" Foreground="Black"/>
                    </Border>
                    
                    <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Background="{StaticResource WhiteBrush}">
                        <StackPanel Margin="5">
                            <!-- Lista de cumpleaños -->
                            <ItemsControl ItemsSource="{Binding CumpleaniosProximos}"
                                          Visibility="{Binding HayCumpleanios, Converter={StaticResource BoolToVisibilityConverter}}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border BorderThickness="0,0,0,1" BorderBrush="#E0E0E0" Padding="3,5" Margin="0,0,0,3">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>
                                                <StackPanel Grid.Column="0">
                                                    <TextBlock Text="{Binding NombreCompleto}" FontFamily="Tahoma" FontSize="10" FontWeight="Bold"/>
                                                    <TextBlock Text="{Binding Cargo}" FontFamily="Tahoma" FontSize="9" Foreground="#808080"/>
                                                    <TextBlock FontFamily="Tahoma" FontSize="9" Foreground="#808080">
                                                        <Run Text="Cumple "/>
                                                        <Run Text="{Binding EdadCumplir, Mode=OneWay}"/>
                                                        <Run Text=" años"/>
                                                    </TextBlock>
                                                </StackPanel>
                                                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                                    <TextBlock Text="{Binding DiasTexto}" FontFamily="Tahoma" FontSize="9" 
                                                               FontWeight="Bold" Foreground="#000080" HorizontalAlignment="Right"/>
                                                    <TextBlock Text="{Binding FechaCumple, StringFormat='dd/MM'}" FontFamily="Tahoma" 
                                                               FontSize="9" Foreground="#808080" HorizontalAlignment="Right"/>
                                                </StackPanel>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                            
                            <!-- Sin cumpleaños -->
                            <TextBlock Text="No hay cumpleaños próximos" FontFamily="Tahoma" FontSize="9" 
                                       Foreground="#808080" FontStyle="Italic" HorizontalAlignment="Center" Margin="0,20,0,0"
                                       Visibility="{Binding HayCumpleanios, Converter={StaticResource InverseBoolToVisibilityConverter}}"/>
                        </StackPanel>
                    </ScrollViewer>
                </Grid>
            </Border>

            <!-- Panel: Aniversarios Laborales -->
            <Border Grid.Column="1" BorderThickness="1" BorderBrush="{StaticResource ShadowBrush}" Margin="2,0,3,0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    
                    <Border Grid.Row="0" Background="#C0C0C0" Padding="5,3">
                        <TextBlock Text="ANIVERSARIOS (7 días)" FontFamily="Tahoma" FontSize="10" 
                                   FontWeight="Bold" Foreground="Black"/>
                    </Border>
                    
                    <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Background="{StaticResource WhiteBrush}">
                        <StackPanel Margin="5">
                            <!-- Lista de aniversarios -->
                            <ItemsControl ItemsSource="{Binding AniversariosProximos}"
                                          Visibility="{Binding HayAniversarios, Converter={StaticResource BoolToVisibilityConverter}}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border BorderThickness="0,0,0,1" BorderBrush="#E0E0E0" Padding="3,5" Margin="0,0,0,3">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>
                                                <StackPanel Grid.Column="0">
                                                    <TextBlock Text="{Binding NombreCompleto}" FontFamily="Tahoma" FontSize="10" FontWeight="Bold"/>
                                                    <TextBlock Text="{Binding Cargo}" FontFamily="Tahoma" FontSize="9" Foreground="#808080"/>
                                                    <TextBlock FontFamily="Tahoma" FontSize="9" Foreground="#808080">
                                                        <Run Text="Cumple "/>
                                                        <Run Text="{Binding AnosTexto, Mode=OneWay}"/>
                                                        <Run Text=" en la empresa"/>
                                                    </TextBlock>
                                                </StackPanel>
                                                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                                    <TextBlock Text="{Binding DiasTexto}" FontFamily="Tahoma" FontSize="9" 
                                                               FontWeight="Bold" Foreground="#000080" HorizontalAlignment="Right"/>
                                                    <TextBlock Text="{Binding FechaAniversario, StringFormat='dd/MM'}" FontFamily="Tahoma" 
                                                               FontSize="9" Foreground="#808080" HorizontalAlignment="Right"/>
                                                </StackPanel>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                            
                            <!-- Sin aniversarios -->
                            <TextBlock Text="No hay aniversarios próximos" FontFamily="Tahoma" FontSize="9" 
                                       Foreground="#808080" FontStyle="Italic" HorizontalAlignment="Center" Margin="0,20,0,0"
                                       Visibility="{Binding HayAniversarios, Converter={StaticResource InverseBoolToVisibilityConverter}}"/>
                        </StackPanel>
                    </ScrollViewer>
                </Grid>
            </Border>

            <!-- Panel: Empleados por Departamento -->
            <Border Grid.Column="2" BorderThickness="1" BorderBrush="{StaticResource ShadowBrush}" Margin="2,0,0,0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    
                    <Border Grid.Row="0" Background="{StaticResource TitleBarBrush}" Padding="{StaticResource SectionHeaderPadding}">
                        <TextBlock Text="EMPLEADOS x DEPTO." FontFamily="Tahoma" FontSize="10" 
                                   FontWeight="Bold" Foreground="White"/>
                    </Border>
                    
                    <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Background="{StaticResource WhiteBrush}">
                        <StackPanel Margin="5">
                            <!-- Lista de departamentos -->
                            <ItemsControl ItemsSource="{Binding EmpleadosPorDepartamento}"
                                          Visibility="{Binding HayEstadisticasDepartamento, Converter={StaticResource BoolToVisibilityConverter}}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Grid Margin="0,3,0,3">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="90"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="40"/>
                                            </Grid.ColumnDefinitions>
                                            
                                            <!-- Nombre del departamento -->
                                            <TextBlock Grid.Column="0" Text="{Binding Etiqueta}" FontFamily="Tahoma" 
                                                       FontSize="9" VerticalAlignment="Center" TextTrimming="CharacterEllipsis"
                                                       ToolTip="{Binding Etiqueta}"/>
                                            
                                            <!-- Barra visual ASCII-style -->
                                            <Border Grid.Column="1" BorderThickness="1" BorderBrush="#808080" Height="12" 
                                                    Margin="5,0" Background="#E0E0E0">
                                                <Border HorizontalAlignment="Left" Background="#000080">
                                                    <Border.Width>
                                                        <MultiBinding Converter="{StaticResource PercentToWidthConverter}" Mode="OneWay">
                                                            <Binding Path="Porcentaje" Mode="OneWay"/>
                                                            <Binding Path="ActualWidth" RelativeSource="{RelativeSource AncestorType=Border}" Mode="OneWay"/>
                                                        </MultiBinding>
                                                    </Border.Width>
                                                </Border>
                                            </Border>
                                            
                                            <!-- Cantidad -->
                                            <TextBlock Grid.Column="2" FontFamily="Courier New" FontSize="10" 
                                                       FontWeight="Bold" HorizontalAlignment="Right" VerticalAlignment="Center">
                                                <Run Text="{Binding Cantidad}"/>
                                            </TextBlock>
                                        </Grid>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                            
                            <!-- Sin datos -->
                            <TextBlock Text="Sin datos disponibles" FontFamily="Tahoma" FontSize="9" 
                                       Foreground="#808080" FontStyle="Italic" HorizontalAlignment="Center" Margin="0,20,0,0"
                                       Visibility="{Binding HayEstadisticasDepartamento, Converter={StaticResource InverseBoolToVisibilityConverter}}"/>
                        </StackPanel>
                    </ScrollViewer>
                </Grid>
            </Border>
        </Grid>
    </Grid>
</UserControl>
