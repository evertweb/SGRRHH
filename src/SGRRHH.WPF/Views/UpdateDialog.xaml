<Window x:Class="SGRRHH.WPF.Views.UpdateDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="Actualización Disponible - SGRRHH"
        Height="450" Width="450"
        WindowStartupLocation="CenterScreen"
        ResizeMode="NoResize"
        WindowStyle="None"
        Background="#C0C0C0">
    
    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="../Resources/Styles/LegacyTheme.xaml"/>
            </ResourceDictionary.MergedDictionaries>
            <BooleanToVisibilityConverter x:Key="BoolToVis"/>
        </ResourceDictionary>
    </Window.Resources>
    
    <!-- Borde exterior 3D (Outset) -->
    <Border BorderThickness="2" BorderBrush="White">
        <Border BorderThickness="2" BorderBrush="#808080" Margin="0,0,2,2">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>  <!-- Barra de título -->
                    <RowDefinition Height="*"/>     <!-- Contenido -->
                </Grid.RowDefinitions>
                
                <!-- Barra de título azul navy -->
                <Grid Grid.Row="0" Background="#000080" Height="22" MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Grid.Column="0" Text="[UPDATE] Actualización Disponible" 
                               Foreground="White" FontFamily="Tahoma" FontSize="11" FontWeight="Bold"
                               VerticalAlignment="Center" Margin="8,0,0,0"/>
                    <!-- Botón cerrar (condicionado) -->
                    <Button Grid.Column="1" Style="{StaticResource LegacyButtonStyle}" 
                            Width="18" Height="16" Margin="2"
                            Click="CloseButton_Click"
                            IsEnabled="{Binding CanClose}">
                        <TextBlock Text="r" FontFamily="Marlett" FontSize="10" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                    </Button>
                </Grid>
                
                <!-- Contenido principal -->
                <Grid Grid.Row="1" Margin="10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>  <!-- Encabezado -->
                        <RowDefinition Height="Auto"/>  <!-- Separador -->
                        <RowDefinition Height="*"/>     <!-- Notas de versión -->
                        <RowDefinition Height="Auto"/>  <!-- Estado (progreso/error/completado) -->
                        <RowDefinition Height="Auto"/>  <!-- Botones -->
                    </Grid.RowDefinitions>
                    
                    <!-- Encabezado -->
                    <StackPanel Grid.Row="0" Margin="0,0,0,10">
                        <TextBlock Text="[!] NUEVA VERSION DISPONIBLE" 
                                   FontFamily="Courier New" FontSize="14" FontWeight="Bold"
                                   Foreground="#000080"/>
                        
                        <Grid Margin="0,10,0,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            
                            <StackPanel Grid.Column="0">
                                <TextBlock Text="Version actual:" FontFamily="Tahoma" FontSize="9" Foreground="#808080"/>
                                <TextBlock Text="{Binding CurrentVersion}" FontFamily="Courier New" FontSize="11" FontWeight="Bold"/>
                            </StackPanel>
                            
                            <StackPanel Grid.Column="1">
                                <TextBlock Text="Nueva version:" FontFamily="Tahoma" FontSize="9" Foreground="#808080"/>
                                <TextBlock Text="{Binding NewVersion}" FontFamily="Courier New" FontSize="11" FontWeight="Bold" Foreground="#008000"/>
                            </StackPanel>
                        </Grid>
                        
                        <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                            <TextBlock Text="Publicada: " FontFamily="Tahoma" FontSize="9" Foreground="#808080"/>
                            <TextBlock Text="{Binding ReleaseDate, StringFormat=dd/MM/yyyy HH:mm}" FontFamily="Tahoma" FontSize="9"/>
                            <TextBlock Text="  |  Tamaño: " FontFamily="Tahoma" FontSize="9" Foreground="#808080"/>
                            <TextBlock Text="{Binding DownloadSize}" FontFamily="Tahoma" FontSize="9"/>
                        </StackPanel>
                        
                        <!-- Indicador de obligatoria -->
                        <Border Visibility="{Binding IsMandatory, Converter={StaticResource BoolToVis}}"
                                Background="#FFFFCC" BorderThickness="2" BorderBrush="#CC6600"
                                Padding="8,5" Margin="0,10,0,0">
                            <TextBlock Text="[!] ACTUALIZACION OBLIGATORIA" 
                                       FontFamily="Courier New" FontSize="10" FontWeight="Bold"
                                       Foreground="#CC6600"/>
                        </Border>
                    </StackPanel>
                    
                    <!-- Separador -->
                    <Border Grid.Row="1" Height="2" Background="#808080" Margin="0,0,0,10"/>
                    
                    <!-- Notas de versión -->
                    <Border Grid.Row="2" BorderThickness="1" BorderBrush="#808080" Background="White" Margin="0,0,0,10">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            
                            <Border Grid.Row="0" Background="#000080" Padding="8,4">
                                <TextBlock Text="[INFO] NOTAS DE VERSION" FontFamily="Courier New" FontSize="9" 
                                           FontWeight="Bold" Foreground="White"/>
                            </Border>
                            
                            <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Padding="8">
                                <TextBlock Text="{Binding ReleaseNotes}"
                                           TextWrapping="Wrap" LineHeight="18"
                                           FontFamily="Tahoma" FontSize="9"/>
                            </ScrollViewer>
                        </Grid>
                    </Border>
                    
                    <!-- Progreso de descarga -->
                    <Border Grid.Row="3" 
                            Visibility="{Binding IsDownloading, Converter={StaticResource BoolToVis}}"
                            Background="#E0E0FF" BorderThickness="1" BorderBrush="#000080"
                            Padding="10" Margin="0,0,0,10">
                        <StackPanel>
                            <TextBlock Text="{Binding StatusMessage}" 
                                       FontFamily="Tahoma" FontSize="9" FontWeight="Bold"
                                       Margin="0,0,0,5"/>
                            <ProgressBar Value="{Binding DownloadProgress}"
                                         Height="16" Minimum="0" Maximum="100"
                                         Background="White" Foreground="#000080"/>
                            <TextBlock Text="{Binding DownloadProgress, StringFormat={}{0}%}"
                                       HorizontalAlignment="Center" FontFamily="Courier New" FontSize="10"
                                       Margin="0,5,0,0"/>
                        </StackPanel>
                    </Border>
                    
                    <!-- Mensaje de error -->
                    <Border Grid.Row="3"
                            Visibility="{Binding HasError, Converter={StaticResource BoolToVis}}"
                            Background="#FFE0E0" BorderThickness="2" BorderBrush="#CC0000"
                            Padding="10" Margin="0,0,0,10">
                        <StackPanel>
                            <TextBlock Text="[X] ERROR EN LA ACTUALIZACION"
                                       FontFamily="Courier New" FontSize="10" FontWeight="Bold"
                                       Foreground="#CC0000"/>
                            <TextBlock Text="{Binding ErrorMessage}"
                                       FontFamily="Tahoma" FontSize="9" Foreground="#CC0000"
                                       TextWrapping="Wrap" Margin="0,5,0,0"/>
                        </StackPanel>
                    </Border>
                    
                    <!-- Descarga completada -->
                    <Border Grid.Row="3"
                            Visibility="{Binding DownloadCompleted, Converter={StaticResource BoolToVis}}"
                            Background="#E0FFE0" BorderThickness="2" BorderBrush="#008000"
                            Padding="10" Margin="0,0,0,10">
                        <StackPanel>
                            <TextBlock Text="[OK] DESCARGA COMPLETADA"
                                       FontFamily="Courier New" FontSize="11" FontWeight="Bold"
                                       Foreground="#008000"/>
                            <TextBlock Text="{Binding StatusMessage}"
                                       FontFamily="Tahoma" FontSize="9" Foreground="#008000"
                                       TextWrapping="Wrap" Margin="0,5,0,0"/>
                        </StackPanel>
                    </Border>
                    
                    <!-- Botones -->
                    <StackPanel Grid.Row="4" Orientation="Horizontal" HorizontalAlignment="Right">
                        
                        <!-- Botón Omitir -->
                        <Button Content="Omitir" Margin="0,0,5,0" Padding="10,5"
                                FontFamily="Tahoma" FontSize="9"
                                Command="{Binding SkipVersionCommand}"
                                IsEnabled="{Binding CanClose}">
                            <Button.Style>
                                <Style TargetType="Button" BasedOn="{StaticResource LegacyButtonStyle}">
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IsMandatory}" Value="True">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding DownloadCompleted}" Value="True">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                        </Button>
                        
                        <!-- Botón Recordar después -->
                        <Button Content="Despues" Margin="0,0,5,0" Padding="10,5"
                                FontFamily="Tahoma" FontSize="9"
                                Command="{Binding RemindLaterCommand}"
                                IsEnabled="{Binding CanClose}">
                            <Button.Style>
                                <Style TargetType="Button" BasedOn="{StaticResource LegacyButtonStyle}">
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IsMandatory}" Value="True">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding DownloadCompleted}" Value="True">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                        </Button>

                        <!-- Botón Descargar -->
                        <Button Padding="12,5"
                                FontFamily="Tahoma" FontSize="9" FontWeight="Bold"
                                Command="{Binding UpdateNowCommand}"
                                IsEnabled="{Binding CanClose}">
                            <Button.Style>
                                <Style TargetType="Button" BasedOn="{StaticResource LegacyButtonStyle}">
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding DownloadCompleted}" Value="True">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding IsDownloading}" Value="True">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                            <TextBlock Text="[>>] Descargar" FontFamily="Courier New" FontSize="10"/>
                        </Button>

                        <!-- Botón Instalar y Reiniciar -->
                        <Button Padding="12,5"
                                Style="{StaticResource LegacyButtonStyle}"
                                FontFamily="Tahoma" FontSize="9" FontWeight="Bold"
                                Command="{Binding InstallAndRestartCommand}"
                                Visibility="{Binding DownloadCompleted, Converter={StaticResource BoolToVis}}"
                                IsEnabled="{Binding CanClose}">
                            <TextBlock Text="[OK] Instalar" FontFamily="Courier New" FontSize="10" Foreground="#008000" FontWeight="Bold"/>
                        </Button>
                    </StackPanel>
                </Grid>
            </Grid>
        </Border>
    </Border>
</Window>
