<Window x:Class="SGRRHH.WPF.Views.UpdateDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="ActualizaciÃ³n Disponible"
        Height="500" Width="500"
        WindowStartupLocation="CenterScreen"
        ResizeMode="NoResize"
        WindowStyle="SingleBorderWindow"
        Background="#FFFFFF">
    
    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>
    </Window.Resources>
    
    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- Encabezado -->
        <StackPanel Grid.Row="0" Margin="0,0,0,15">
            <TextBlock Text="ðŸš€ Nueva VersiÃ³n Disponible"
                       FontSize="22"
                       FontWeight="Bold"
                       Foreground="#1976D2"/>
            
            <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                <TextBlock Text="VersiÃ³n actual: " Opacity="0.7"/>
                <TextBlock Text="{Binding CurrentVersion}" FontWeight="SemiBold"/>
                <TextBlock Text="  â†’  " Opacity="0.5"/>
                <TextBlock Text="Nueva versiÃ³n: " Opacity="0.7"/>
                <TextBlock Text="{Binding NewVersion}" 
                           FontWeight="Bold" 
                           Foreground="#1976D2"/>
            </StackPanel>
            
            <StackPanel Orientation="Horizontal" Margin="0,5,0,0">
                <TextBlock Text="ðŸ“… Publicada: " Opacity="0.7"/>
                <TextBlock Text="{Binding ReleaseDate, StringFormat={}{0:dd/MM/yyyy HH:mm}}"/>
                <TextBlock Text="  |  " Opacity="0.3"/>
                <TextBlock Text="ðŸ’¾ TamaÃ±o: " Opacity="0.7"/>
                <TextBlock Text="{Binding DownloadSize}"/>
            </StackPanel>
            
            <!-- Indicador de obligatoria -->
            <Border Visibility="{Binding IsMandatory, Converter={StaticResource BoolToVis}}"
                    Background="#FFF3E0"
                    BorderBrush="#FF9800"
                    BorderThickness="1"
                    CornerRadius="4"
                    Padding="10,5"
                    Margin="0,10,0,0">
                <TextBlock Text="âš ï¸ Esta es una actualizaciÃ³n obligatoria"
                           Foreground="#E65100"
                           FontWeight="SemiBold"/>
            </Border>
        </StackPanel>
        
        <!-- Separador -->
        <Separator Grid.Row="1" Margin="0,0,0,10"/>
        
        <!-- Notas de versiÃ³n -->
        <GroupBox Grid.Row="2" Header="ðŸ“‹ Notas de la versiÃ³n" Margin="0,0,0,15">
            <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="5">
                <TextBlock Text="{Binding ReleaseNotes}"
                           TextWrapping="Wrap"
                           LineHeight="22"/>
            </ScrollViewer>
        </GroupBox>
        
        <!-- Progreso de descarga -->
        <Border Grid.Row="3" 
                Visibility="{Binding IsDownloading, Converter={StaticResource BoolToVis}}"
                Background="#E3F2FD"
                CornerRadius="4"
                Padding="15"
                Margin="0,0,0,15">
            <StackPanel>
                <TextBlock Text="{Binding StatusMessage}" 
                           FontWeight="SemiBold"
                           Margin="0,0,0,8"/>
                <ProgressBar Value="{Binding DownloadProgress}"
                             Height="20"
                             Minimum="0"
                             Maximum="100"/>
                <TextBlock Text="{Binding DownloadProgress, StringFormat={}{0}%}"
                           HorizontalAlignment="Center"
                           Margin="0,5,0,0"/>
            </StackPanel>
        </Border>
        
        <!-- Mensaje de error -->
        <Border Grid.Row="3"
                Visibility="{Binding HasError, Converter={StaticResource BoolToVis}}"
                Background="#FFEBEE"
                BorderBrush="#F44336"
                BorderThickness="1"
                CornerRadius="4"
                Padding="15"
                Margin="0,0,0,15">
            <StackPanel>
                <TextBlock Text="âŒ Error durante la actualizaciÃ³n"
                           FontWeight="Bold"
                           Foreground="#C62828"/>
                <TextBlock Text="{Binding ErrorMessage}"
                           Foreground="#C62828"
                           TextWrapping="Wrap"
                           Margin="0,5,0,0"/>
            </StackPanel>
        </Border>
        
        <!-- Descarga completada -->
        <Border Grid.Row="3"
                Visibility="{Binding DownloadCompleted, Converter={StaticResource BoolToVis}}"
                Background="#E8F5E9"
                BorderBrush="#4CAF50"
                BorderThickness="1"
                CornerRadius="4"
                Padding="15"
                Margin="0,0,0,15">
            <StackPanel>
                <TextBlock Text="âœ… ActualizaciÃ³n lista para instalar"
                           FontWeight="Bold"
                           Foreground="#2E7D32"/>
                <TextBlock Text="La aplicaciÃ³n se cerrarÃ¡ y reiniciarÃ¡ automÃ¡ticamente para completar la instalaciÃ³n."
                           Foreground="#2E7D32"
                           TextWrapping="Wrap"
                           Margin="0,5,0,0"/>
            </StackPanel>
        </Border>
        
        <!-- Botones -->
        <StackPanel Grid.Row="4" 
                    Orientation="Horizontal" 
                    HorizontalAlignment="Right">
            
            <!-- BotÃ³n Omitir (solo si no es obligatoria y no hay descarga) -->
            <Button Content="Omitir esta versiÃ³n"
                    Margin="0,0,10,0"
                    Padding="15,8"
                    Command="{Binding SkipVersionCommand}"
                    Visibility="{Binding IsMandatory, Converter={StaticResource BoolToVis}, ConverterParameter=Inverse}"
                    IsEnabled="{Binding IsDownloading, Converter={StaticResource BoolToVis}, ConverterParameter=Inverse}"/>
            
            <!-- BotÃ³n Recordar despuÃ©s (solo si no es obligatoria) -->
            <Button Content="Recordar despuÃ©s"
                    Margin="0,0,10,0"
                    Padding="15,8"
                    Command="{Binding RemindLaterCommand}"
                    Visibility="{Binding IsMandatory, Converter={StaticResource BoolToVis}, ConverterParameter=Inverse}"
                    IsEnabled="{Binding IsDownloading, Converter={StaticResource BoolToVis}, ConverterParameter=Inverse}"/>

            <!-- BotÃ³n Instalar al cerrar (solo si no estÃ¡ descargando y no es obligatoria) -->
            <Button Content="ðŸ“¥ Instalar al cerrar"
                    Margin="0,0,10,0"
                    Padding="15,8"
                    Command="{Binding InstallOnExitCommand}"
                    Visibility="{Binding IsMandatory, Converter={StaticResource BoolToVis}, ConverterParameter=Inverse}"
                    IsEnabled="{Binding IsDownloading, Converter={StaticResource BoolToVis}, ConverterParameter=Inverse}"
                    ToolTip="Descarga la actualizaciÃ³n ahora e instala cuando cierre la aplicaciÃ³n"/>

            <!-- BotÃ³n Actualizar ahora / Reiniciar -->
            <Button Padding="20,8"
                    IsEnabled="{Binding IsDownloading, Converter={StaticResource BoolToVis}, ConverterParameter=Inverse}">
                <Button.Style>
                    <Style TargetType="Button" BasedOn="{StaticResource {x:Type Button}}">
                        <Setter Property="Content" Value="ðŸ”„ Actualizar ahora"/>
                        <Setter Property="Command" Value="{Binding UpdateNowCommand}"/>
                        <Setter Property="Background" Value="#1976D2"/>
                        <Setter Property="Foreground" Value="White"/>
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding DownloadCompleted}" Value="True">
                                <Setter Property="Content" Value="ðŸš€ Reiniciar ahora"/>
                                <Setter Property="Command" Value="{Binding RestartNowCommand}"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Button.Style>
            </Button>
        </StackPanel>
    </Grid>
</Window>
