<UserControl x:Class="SGRRHH.WPF.Views.DailyActivityWizardView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:converters="clr-namespace:SGRRHH.WPF.Converters"
             xmlns:views="clr-namespace:SGRRHH.WPF.Views"
             mc:Ignorable="d"
             d:DesignHeight="600" d:DesignWidth="800"
             Background="#C0C0C0">
    
    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="../Resources/Styles/LegacyTheme.xaml"/>
            </ResourceDictionary.MergedDictionaries>
            <converters:BoolToVisibilityConverter x:Key="BoolToVisConverter"/>
            <converters:InverseBoolToVisibilityConverter x:Key="InverseBoolToVisConverter"/>
            <converters:StringToVisibilityConverter x:Key="StringToVisConverter"/>
            <converters:TimeSpanToStringConverter x:Key="TimeSpanToStringConverter"/>
            
            <!-- Estilo Legacy para tarjetas de opción -->
            <Style x:Key="LegacyOptionCardStyle" TargetType="Button" BasedOn="{StaticResource LegacyButtonStyle}">
                <Setter Property="Cursor" Value="Hand"/>
                <Setter Property="Padding" Value="15,20"/>
            </Style>
            
            <!-- Estilo Legacy para items de actividad -->
            <Style x:Key="LegacyActivityListBoxItemStyle" TargetType="ListBoxItem">
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="ListBoxItem">
                            <Border x:Name="Border" 
                                    Background="White" 
                                    BorderBrush="#808080" 
                                    BorderThickness="1" 
                                    Margin="0,0,0,4" 
                                    Padding="8"
                                    Cursor="Hand">
                                <ContentPresenter/>
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsSelected" Value="True">
                                    <Setter TargetName="Border" Property="Background" Value="#C0C0FF"/>
                                    <Setter TargetName="Border" Property="BorderBrush" Value="#000080"/>
                                    <Setter TargetName="Border" Property="BorderThickness" Value="2"/>
                                </Trigger>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter TargetName="Border" Property="Background" Value="#E0E0E0"/>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>
        </ResourceDictionary>
    </UserControl.Resources>

    <Grid>
        <!-- ==================== PANTALLA DE BIENVENIDA ==================== -->
        <Grid Visibility="{Binding IsHomeVisible, Converter={StaticResource BoolToVisConverter}}">
            <Grid.RowDefinitions>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            
            <StackPanel Grid.Row="0" VerticalAlignment="Center" HorizontalAlignment="Center" MaxWidth="500">
                <!-- Saludo -->
                <TextBlock Text="[WIZARD]" FontFamily="Courier New" FontSize="24" FontWeight="Bold"
                           Foreground="#000080" HorizontalAlignment="Center" Margin="0,0,0,10"/>
                <TextBlock Text="REGISTRO DE ACTIVIDADES" FontFamily="Tahoma" FontSize="14" FontWeight="Bold" 
                           Foreground="#000000" HorizontalAlignment="Center" Margin="0,0,0,5"/>
                <TextBlock Text="Seleccione una opcion:" FontFamily="Tahoma" FontSize="10" 
                           Foreground="#404040" HorizontalAlignment="Center" Margin="0,0,0,30"/>
                
                <!-- Opciones -->
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                    <!-- Opción: Crear Registro -->
                    <Border Background="White" BorderThickness="2" BorderBrush="#808080"
                            Padding="20,15" Margin="0,0,15,0" Cursor="Hand" Width="180">
                        <Border.InputBindings>
                            <MouseBinding MouseAction="LeftClick" Command="{Binding ShowWizardCommand}"/>
                        </Border.InputBindings>
                        <StackPanel HorizontalAlignment="Center">
                            <Border Background="#008000" Width="50" Height="50" 
                                    HorizontalAlignment="Center" Margin="0,0,0,10">
                                <TextBlock Text="[+]" FontFamily="Courier New" FontSize="20" FontWeight="Bold"
                                           Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Border>
                            <TextBlock Text="Crear Registro" FontFamily="Tahoma" FontSize="10" FontWeight="Bold"
                                       Foreground="#000000" HorizontalAlignment="Center" Margin="0,0,0,4"/>
                            <TextBlock Text="Registrar actividades" FontFamily="Tahoma" FontSize="8"
                                       Foreground="#808080" HorizontalAlignment="Center"/>
                            <TextBlock Text="del dia paso a paso" FontFamily="Tahoma" FontSize="8"
                                       Foreground="#808080" HorizontalAlignment="Center"/>
                        </StackPanel>
                    </Border>
                    
                    <!-- Opción: Ver Registros -->
                    <Border Background="White" BorderThickness="2" BorderBrush="#808080"
                            Padding="20,15" Cursor="Hand" Width="180">
                        <Border.InputBindings>
                            <MouseBinding MouseAction="LeftClick" Command="{Binding ShowDashboardCommand}"/>
                        </Border.InputBindings>
                        <StackPanel HorizontalAlignment="Center">
                            <Border Background="#000080" Width="50" Height="50" 
                                    HorizontalAlignment="Center" Margin="0,0,0,10">
                                <TextBlock Text="[=]" FontFamily="Courier New" FontSize="20" FontWeight="Bold"
                                           Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Border>
                            <TextBlock Text="Ver Registros" FontFamily="Tahoma" FontSize="10" FontWeight="Bold"
                                       Foreground="#000000" HorizontalAlignment="Center" Margin="0,0,0,4"/>
                            <TextBlock Text="Consultar y administrar" FontFamily="Tahoma" FontSize="8"
                                       Foreground="#808080" HorizontalAlignment="Center"/>
                            <TextBlock Text="registros existentes" FontFamily="Tahoma" FontSize="8"
                                       Foreground="#808080" HorizontalAlignment="Center"/>
                        </StackPanel>
                    </Border>
                </StackPanel>
            </StackPanel>
            
            <!-- Footer con fecha actual -->
            <Border Grid.Row="1" Background="#E0E0E0" Padding="10,8" BorderThickness="0,1,0,0" BorderBrush="#808080">
                <TextBlock HorizontalAlignment="Center" FontFamily="Tahoma" FontSize="9" Foreground="#404040">
                    <Run Text="Fecha: "/>
                    <Run Text="{Binding CurrentDateText, Mode=OneWay}"/>
                </TextBlock>
            </Border>
        </Grid>

        <!-- ==================== WIZARD CONTAINER ==================== -->
        <Grid Visibility="{Binding IsWizardVisible, Converter={StaticResource BoolToVisConverter}}">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Header del Wizard -->
            <Border Grid.Row="0" Background="#000080" Padding="10,8">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <!-- Botón Volver -->
                    <Button Grid.Column="0" Content="&lt;- Volver" 
                            Command="{Binding GoHomeCommand}"
                            Style="{StaticResource LegacyButtonStyle}"
                            FontFamily="Tahoma" FontSize="9" Padding="10,3" Margin="0,0,15,0"/>
                    
                    <StackPanel Grid.Column="1" VerticalAlignment="Center">
                        <TextBlock Text="{Binding StepTitle}" FontFamily="Tahoma" FontSize="11" FontWeight="Bold" 
                                   Foreground="White"/>
                        <TextBlock Text="{Binding StepDescription}" FontFamily="Tahoma" FontSize="9" 
                                   Foreground="#C0C0FF" Margin="0,2,0,0"/>
                    </StackPanel>
                    
                    <!-- Progreso -->
                    <Border Grid.Column="2" Background="White" Padding="8,4">
                        <TextBlock FontFamily="Courier New" FontSize="10" FontWeight="Bold" Foreground="#000080">
                            <Run Text="{Binding ProgressPercentage, Mode=OneWay}"/>
                            <Run Text="%"/>
                        </TextBlock>
                    </Border>
                </Grid>
            </Border>

            <!-- Content del Wizard -->
            <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Margin="8">
                <Border Background="White" BorderThickness="1" BorderBrush="#808080" Padding="15">
                <StackPanel MaxWidth="700" HorizontalAlignment="Center">
                    
                    <!-- Step 1: Seleccionar Empleados -->
                    <StackPanel Visibility="{Binding IsSelectEmployeesVisible, Converter={StaticResource BoolToVisConverter}}" Margin="0,0,0,15">
                        <TextBlock Text="Seleccione los empleados:" FontFamily="Tahoma" FontSize="10" 
                                   FontWeight="Bold" Foreground="#000080" Margin="0,0,0,10"/>
                        
                        <ItemsControl ItemsSource="{Binding AllEmpleados, Mode=OneWay}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <WrapPanel Orientation="Horizontal"/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <CheckBox Command="{Binding DataContext.ToggleEmployeeCommand, RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                                              CommandParameter="{Binding .}" Margin="0,0,8,8" 
                                              FontFamily="Tahoma" FontSize="9">
                                        <CheckBox.IsChecked>
                                            <MultiBinding Converter="{StaticResource CollectionContainsConverter}" Mode="OneWay">
                                                <Binding Path="." />
                                                <Binding Path="DataContext.SelectedEmpleados" RelativeSource="{RelativeSource AncestorType=ItemsControl}" />
                                            </MultiBinding>
                                        </CheckBox.IsChecked>
                                        <Border Background="#E0E0E0" BorderThickness="1" BorderBrush="#808080" Padding="8,5" MinWidth="120">
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Text="[U]" FontFamily="Courier New" FontSize="10" FontWeight="Bold"
                                                           Foreground="#000080" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                                <StackPanel>
                                                    <TextBlock Text="{Binding NombreCompleto}" FontFamily="Tahoma" FontSize="9" 
                                                               FontWeight="Bold" TextWrapping="Wrap"/>
                                                    <TextBlock Text="{Binding Cargo.Nombre}" FontFamily="Tahoma" FontSize="8" 
                                                               Foreground="#808080" TextWrapping="Wrap"/>
                                                </StackPanel>
                                            </StackPanel>
                                        </Border>
                                    </CheckBox>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                        
                        <Border Background="#E0E0E0" BorderThickness="1" BorderBrush="#808080" Padding="8" Margin="0,10,0,0">
                            <TextBlock FontFamily="Tahoma" FontSize="9" Foreground="#404040">
                                <Run Text="Empleados seleccionados: " FontWeight="Bold"/>
                                <Run Text="{Binding SelectedEmpleados.Count, Mode=OneWay}"/>
                            </TextBlock>
                        </Border>
                    </StackPanel>

                    <!-- Step 2: Seleccionar Fecha -->
                    <StackPanel Visibility="{Binding IsSelectDateVisible, Converter={StaticResource BoolToVisConverter}}" Margin="0,0,0,15">
                        <TextBlock Text="Seleccione la fecha:" FontFamily="Tahoma" FontSize="10" 
                                   FontWeight="Bold" Foreground="#000080" Margin="0,0,0,8"/>
                        <DatePicker SelectedDate="{Binding SelectedDate}" Width="150" HorizontalAlignment="Left"
                                    FontFamily="Tahoma" FontSize="9"/>
                    </StackPanel>

                    <!-- Step 3: Hora de Entrada -->
                    <StackPanel Visibility="{Binding IsEnterEntradaVisible, Converter={StaticResource BoolToVisConverter}}" Margin="0,0,0,15">
                        <TextBlock Text="Hora de Entrada:" FontFamily="Tahoma" FontSize="10" 
                                   FontWeight="Bold" Foreground="#000080" Margin="0,0,0,10"/>

                        <Border Background="#E0E0E0" BorderThickness="1" BorderBrush="#808080" Padding="20">
                            <StackPanel HorizontalAlignment="Center">
                                <TextBlock Text="[ENTRADA]" FontFamily="Courier New" FontSize="14" FontWeight="Bold"
                                           Foreground="#000080" HorizontalAlignment="Center" Margin="0,0,0,15"/>

                                <Grid Width="200">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <StackPanel Grid.Column="0">
                                        <TextBlock Text="Hora" FontFamily="Tahoma" FontSize="8" Foreground="#404040" 
                                                   HorizontalAlignment="Center" Margin="0,0,0,3"/>
                                        <TextBox Text="{Binding HoraEntradaHorasText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                 Style="{StaticResource LegacyTextBoxStyle}"
                                                 HorizontalContentAlignment="Center" FontFamily="Courier New" 
                                                 FontSize="24" FontWeight="Bold" Height="40" MaxLength="2"/>
                                    </StackPanel>

                                    <TextBlock Grid.Column="1" Text=":" FontFamily="Courier New" FontSize="24" FontWeight="Bold" 
                                               VerticalAlignment="Bottom" HorizontalAlignment="Center" Margin="5,0,5,8"/>

                                    <StackPanel Grid.Column="2">
                                        <TextBlock Text="Min" FontFamily="Tahoma" FontSize="8" Foreground="#404040" 
                                                   HorizontalAlignment="Center" Margin="0,0,0,3"/>
                                        <TextBox Text="{Binding HoraEntradaMinutosText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                 Style="{StaticResource LegacyTextBoxStyle}"
                                                 HorizontalContentAlignment="Center" FontFamily="Courier New" 
                                                 FontSize="24" FontWeight="Bold" Height="40" MaxLength="2"/>
                                    </StackPanel>
                                </Grid>

                                <TextBlock Text="Formato 24h (Ej: 08:30)" FontFamily="Tahoma" FontSize="8"
                                           HorizontalAlignment="Center" Foreground="#808080" Margin="0,10,0,0"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>

                    <!-- Step 4: Hora de Salida -->
                    <StackPanel Visibility="{Binding IsEnterSalidaVisible, Converter={StaticResource BoolToVisConverter}}" Margin="0,0,0,15">
                        <TextBlock Text="Hora de Salida:" FontFamily="Tahoma" FontSize="10" 
                                   FontWeight="Bold" Foreground="#000080" Margin="0,0,0,10"/>

                        <Border Background="#E0E0E0" BorderThickness="1" BorderBrush="#808080" Padding="20">
                            <StackPanel HorizontalAlignment="Center">
                                <TextBlock Text="[SALIDA]" FontFamily="Courier New" FontSize="14" FontWeight="Bold"
                                           Foreground="#000080" HorizontalAlignment="Center" Margin="0,0,0,15"/>

                                <Grid Width="200">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <StackPanel Grid.Column="0">
                                        <TextBlock Text="Hora" FontFamily="Tahoma" FontSize="8" Foreground="#404040" 
                                                   HorizontalAlignment="Center" Margin="0,0,0,3"/>
                                        <TextBox Text="{Binding HoraSalidaHorasText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                 Style="{StaticResource LegacyTextBoxStyle}"
                                                 HorizontalContentAlignment="Center" FontFamily="Courier New" 
                                                 FontSize="24" FontWeight="Bold" Height="40" MaxLength="2"/>
                                    </StackPanel>

                                    <TextBlock Grid.Column="1" Text=":" FontFamily="Courier New" FontSize="24" FontWeight="Bold" 
                                               VerticalAlignment="Bottom" HorizontalAlignment="Center" Margin="5,0,5,8"/>

                                    <StackPanel Grid.Column="2">
                                        <TextBlock Text="Min" FontFamily="Tahoma" FontSize="8" Foreground="#404040" 
                                                   HorizontalAlignment="Center" Margin="0,0,0,3"/>
                                        <TextBox Text="{Binding HoraSalidaMinutosText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                 Style="{StaticResource LegacyTextBoxStyle}"
                                                 HorizontalContentAlignment="Center" FontFamily="Courier New" 
                                                 FontSize="24" FontWeight="Bold" Height="40" MaxLength="2"/>
                                    </StackPanel>
                                </Grid>

                                <TextBlock Text="Formato 24h (Ej: 17:30)" FontFamily="Tahoma" FontSize="8"
                                           HorizontalAlignment="Center" Foreground="#808080" Margin="0,10,0,0"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>

                    <!-- Step 5: Seleccionar Actividad -->
                    <StackPanel Visibility="{Binding IsSelectActivityVisible, Converter={StaticResource BoolToVisConverter}}" Margin="0,0,0,15">
                        <TextBlock Text="Seleccione la actividad:" FontFamily="Tahoma" FontSize="10" 
                                   FontWeight="Bold" Foreground="#000080" Margin="0,0,0,10"/>
                        
                        <ListBox ItemsSource="{Binding AllActividades, Mode=OneWay}" 
                                 SelectedItem="{Binding SelectedActivity}" 
                                 ItemContainerStyle="{StaticResource LegacyActivityListBoxItemStyle}"
                                 BorderThickness="1" BorderBrush="#808080" Background="White" 
                                 ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                                 MaxHeight="250">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        
                                        <TextBlock Grid.Column="0" Text="[A]" FontFamily="Courier New" FontSize="10" 
                                                   FontWeight="Bold" Foreground="#000080" 
                                                   VerticalAlignment="Center" Margin="0,0,10,0"/>
                                        
                                        <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                            <TextBlock Text="{Binding Nombre}" FontFamily="Tahoma" FontSize="9" 
                                                       FontWeight="Bold" Foreground="#000000"/>
                                            <StackPanel Orientation="Horizontal" Margin="0,2,0,0">
                                                <TextBlock Text="{Binding Categoria}" FontFamily="Tahoma" FontSize="8" 
                                                           Foreground="#808080" Margin="0,0,10,0"/>
                                                <TextBlock Text="{Binding Descripcion}" FontFamily="Tahoma" FontSize="8" 
                                                           Foreground="#808080" TextTrimming="CharacterEllipsis" MaxWidth="300"
                                                           Visibility="{Binding Descripcion, Converter={StaticResource StringToVisConverter}}"/>
                                            </StackPanel>
                                        </StackPanel>
                                    </Grid>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </StackPanel>

                    <!-- Step 6: Seleccionar Proyecto -->
                    <StackPanel Visibility="{Binding IsSelectProjectVisible, Converter={StaticResource BoolToVisConverter}}" Margin="0,0,0,15">
                        <TextBlock Text="Proyecto (opcional):" FontFamily="Tahoma" FontSize="10" 
                                   FontWeight="Bold" Foreground="#000080" Margin="0,0,0,10"/>
                        
                        <Border Background="#E0E0E0" BorderThickness="1" BorderBrush="#808080" Padding="15">
                            <StackPanel>
                                <TextBlock Text="Proyecto Asociado:" FontFamily="Tahoma" FontSize="9" 
                                           FontWeight="Bold" Margin="0,0,0,8"/>
                                <ComboBox ItemsSource="{Binding AllProyectos, Mode=OneWay}" 
                                          SelectedItem="{Binding SelectedProject}" 
                                          DisplayMemberPath="Nombre" 
                                          FontFamily="Tahoma" FontSize="9" Height="24"/>
                                <TextBlock Text="Si no aplica, seleccione 'Sin proyecto'." 
                                           FontFamily="Tahoma" FontSize="8" Foreground="#808080" Margin="0,8,0,0"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>

                    <!-- Step 7: Horas Calculadas Automáticamente -->
                    <StackPanel Visibility="{Binding IsEnterHoursVisible, Converter={StaticResource BoolToVisConverter}}" Margin="0,0,0,15">
                        <TextBlock Text="Horas Trabajadas:" FontFamily="Tahoma" FontSize="10" 
                                   FontWeight="Bold" Foreground="#000080" Margin="0,0,0,10"/>

                        <Border Background="#E0E0E0" BorderThickness="1" BorderBrush="#808080" Padding="20">
                            <StackPanel HorizontalAlignment="Center">
                                <!-- Indicador de cálculo automático -->
                                <TextBlock Text="[CALCULO AUTOMATICO]" FontFamily="Courier New" FontSize="10" FontWeight="Bold"
                                           Foreground="#008000" HorizontalAlignment="Center" Margin="0,0,0,15"/>

                                <!-- Display de horas calculadas -->
                                <Border Background="White" BorderThickness="2" BorderBrush="#000080" Padding="20,15" Margin="0,0,0,15">
                                    <StackPanel HorizontalAlignment="Center">
                                        <TextBlock Text="{Binding Hours, StringFormat='0.0'}" FontFamily="Courier New" FontSize="36" FontWeight="Bold"
                                                   Foreground="#000080" HorizontalAlignment="Center"/>
                                        <TextBlock Text="HORAS" FontFamily="Tahoma" FontSize="10" FontWeight="Bold"
                                                   Foreground="#000080" HorizontalAlignment="Center" Margin="0,5,0,0"/>
                                    </StackPanel>
                                </Border>

                                <!-- Explicación del cálculo -->
                                <Border Background="#FFFFCC" BorderThickness="1" BorderBrush="#808080" Padding="12,8">
                                    <StackPanel>
                                        <TextBlock Text="[i] Detalle:" FontFamily="Courier New" FontSize="9" FontWeight="Bold"
                                                   Foreground="#404040" Margin="0,0,0,5"/>
                                        <TextBlock Text="{Binding HorasCalculadasText}" TextWrapping="Wrap" FontFamily="Tahoma" FontSize="8"
                                                   Foreground="#404040" HorizontalAlignment="Center"/>
                                    </StackPanel>
                                </Border>

                                <!-- Opción para ajustar manualmente -->
                                <Expander Header="[+] Ajustar manualmente" FontFamily="Tahoma" FontSize="8" Margin="0,12,0,0" HorizontalAlignment="Center">
                                    <StackPanel Margin="0,8,0,0">
                                        <TextBlock Text="Solo si necesita modificar:" FontFamily="Tahoma" FontSize="8"
                                                   Foreground="#808080" Margin="0,0,0,8" HorizontalAlignment="Center"/>
                                        <Grid Width="250">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>

                                            <Slider Grid.Column="0" Value="{Binding Hours}" Minimum="0.5" Maximum="12" TickFrequency="0.5"
                                                    IsSnapToTickEnabled="True" VerticalAlignment="Center" Margin="0,0,15,0"/>

                                            <TextBlock Grid.Column="1" Text="{Binding Hours, StringFormat='0.0 h'}" FontFamily="Courier New" FontSize="12" FontWeight="Bold"
                                                       VerticalAlignment="Center" Foreground="#000080"/>
                                        </Grid>
                                    </StackPanel>
                                </Expander>
                            </StackPanel>
                        </Border>
                    </StackPanel>

                    <!-- Step 8: Descripción -->
                    <StackPanel Visibility="{Binding IsEnterDescriptionVisible, Converter={StaticResource BoolToVisConverter}}" Margin="0,0,0,15">
                        <TextBlock Text="Descripcion de la actividad:" FontFamily="Tahoma" FontSize="10" 
                                   FontWeight="Bold" Foreground="#000080" Margin="0,0,0,10"/>
                        
                        <Grid>
                            <TextBox Text="{Binding Description}" Style="{StaticResource LegacyTextBoxStyle}" 
                                     Height="120" TextWrapping="Wrap" AcceptsReturn="True" VerticalContentAlignment="Top"
                                     FontFamily="Tahoma" FontSize="9" Padding="8"/>
                            
                            <TextBlock Text="Escriba aqui los detalles..." IsHitTestVisible="False"
                                       FontFamily="Tahoma" FontSize="9" Foreground="#808080" Margin="10,10,0,0"
                                       Visibility="{Binding Description, Converter={StaticResource IsNullOrEmptyToVisibilityConverter}}"/>
                        </Grid>
                        <TextBlock Text="Sea breve pero especifico sobre las tareas realizadas." 
                                   FontFamily="Tahoma" FontSize="8" Foreground="#808080" Margin="0,5,0,0"/>
                    </StackPanel>

                    <!-- Step 9: Resumen -->
                    <StackPanel Visibility="{Binding IsReviewVisible, Converter={StaticResource BoolToVisConverter}}" Margin="0,0,0,15">
                        <TextBlock Text="Revise los datos antes de guardar:" FontFamily="Tahoma" FontSize="10" 
                                   FontWeight="Bold" Foreground="#000080" Margin="0,0,0,10"/>
                        
                        <Border Background="White" BorderThickness="2" BorderBrush="#000080" Margin="0,0,0,10">
                            <StackPanel>
                                <!-- Header del resumen -->
                                <Border Background="#000080" Padding="10,8">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <StackPanel Grid.Column="0">
                                            <TextBlock Text="[RESUMEN DE ACTIVIDAD]" FontFamily="Courier New" FontSize="10" FontWeight="Bold" Foreground="White"/>
                                            <TextBlock Text="{Binding SelectedDate, StringFormat='dddd, dd MMMM yyyy'}" FontFamily="Tahoma" FontSize="9" Foreground="#E0E0E0" Margin="0,2,0,0"/>
                                            <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                                                <TextBlock Text="Horario: " FontFamily="Tahoma" FontSize="8" Foreground="#E0E0E0"/>
                                                <TextBlock Text="{Binding HoraEntrada, Converter={StaticResource TimeSpanToStringConverter}}" FontFamily="Courier New" FontSize="9" FontWeight="Bold" Foreground="White"/>
                                                <TextBlock Text=" - " FontFamily="Tahoma" FontSize="9" Foreground="White"/>
                                                <TextBlock Text="{Binding HoraSalida, Converter={StaticResource TimeSpanToStringConverter}}" FontFamily="Courier New" FontSize="9" FontWeight="Bold" Foreground="White"/>
                                            </StackPanel>
                                        </StackPanel>
                                        <Border Grid.Column="1" Background="White" Padding="10,5">
                                            <TextBlock FontFamily="Courier New" FontWeight="Bold" Foreground="#000080" FontSize="11">
                                                <Run Text="{Binding Hours, StringFormat='0.0'}"/>
                                                <Run Text=" Hrs"/>
                                            </TextBlock>
                                        </Border>
                                    </Grid>
                                </Border>
                                
                                <!-- Contenido del resumen -->
                                <Border Padding="15">
                                    <StackPanel>
                                        <TextBlock Text="Empleados:" FontFamily="Tahoma" FontSize="9" FontWeight="Bold" Foreground="#404040"/>
                                        <ItemsControl ItemsSource="{Binding SelectedEmpleados, Mode=OneWay}" Margin="0,5,0,15">
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate>
                                                    <Border Background="#E0E0E0" BorderThickness="1" BorderBrush="#808080" Padding="8,4" Margin="0,0,5,5">
                                                        <StackPanel Orientation="Horizontal">
                                                            <TextBlock Text="[U]" FontFamily="Courier New" FontSize="8" FontWeight="Bold" Foreground="#000080" Margin="0,0,5,0"/>
                                                            <TextBlock Text="{Binding NombreCompleto}" FontFamily="Tahoma" FontSize="8" FontWeight="Bold"/>
                                                        </StackPanel>
                                                    </Border>
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                            <ItemsControl.ItemsPanel>
                                                <ItemsPanelTemplate>
                                                    <WrapPanel/>
                                                </ItemsPanelTemplate>
                                            </ItemsControl.ItemsPanel>
                                        </ItemsControl>

                                        <Grid Margin="0,0,0,15">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            
                                            <StackPanel Grid.Column="0" Margin="0,0,10,0">
                                                <TextBlock Text="Actividad:" FontFamily="Tahoma" FontSize="9" FontWeight="Bold" Foreground="#404040"/>
                                                <TextBlock Text="{Binding SelectedActivity.Nombre}" FontFamily="Tahoma" FontSize="10" FontWeight="Bold" TextWrapping="Wrap" Margin="0,3,0,0"/>
                                                <Border Background="#FFFFCC" BorderThickness="1" BorderBrush="#808080" HorizontalAlignment="Left" Padding="5,2" Margin="0,5,0,0">
                                                    <TextBlock Text="{Binding SelectedActivity.Categoria}" FontFamily="Tahoma" FontSize="8" Foreground="#404040"/>
                                                </Border>
                                            </StackPanel>
                                            
                                            <StackPanel Grid.Column="1">
                                                <TextBlock Text="Proyecto:" FontFamily="Tahoma" FontSize="9" FontWeight="Bold" Foreground="#404040"/>
                                                <StackPanel Orientation="Horizontal" Margin="0,3,0,0">
                                                    <TextBlock Text="[P]" FontFamily="Courier New" FontSize="8" FontWeight="Bold" Foreground="#000080" Margin="0,0,5,0" VerticalAlignment="Center"/>
                                                    <TextBlock Text="{Binding SelectedProject.Nombre}" FontFamily="Tahoma" FontSize="9" TextWrapping="Wrap" VerticalAlignment="Center"/>
                                                </StackPanel>
                                            </StackPanel>
                                        </Grid>

                                        <TextBlock Text="Descripcion:" FontFamily="Tahoma" FontSize="9" FontWeight="Bold" Foreground="#404040"/>
                                        <Border Background="#F0F0F0" BorderThickness="1" BorderBrush="#808080" Padding="10" Margin="0,5,0,0">
                                            <TextBlock Text="{Binding Description}" TextWrapping="Wrap" FontFamily="Tahoma" FontSize="9" FontStyle="Italic"/>
                                        </Border>
                                    </StackPanel>
                                </Border>
                            </StackPanel>
                        </Border>
                    </StackPanel>

                    <!-- Status Message -->
                    <Border Background="#FFFFCC" BorderThickness="1" BorderBrush="#808080" Padding="10" Margin="0,15,0,0"
                           Visibility="{Binding StatusMessage, Converter={StaticResource StringToVisConverter}}">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="[!]" FontFamily="Courier New" FontSize="10" FontWeight="Bold" Foreground="#FF6600" Margin="0,0,8,0"/>
                            <TextBlock Text="{Binding StatusMessage}" TextWrapping="Wrap" FontFamily="Tahoma" FontSize="9"/>
                        </StackPanel>
                    </Border>
                </StackPanel>
                </Border>
            </ScrollViewer>

            <!-- Footer del Wizard -->
            <Border Grid.Row="2" Background="#C0C0C0" Padding="15,10" BorderBrush="#808080" BorderThickness="0,1,0,0">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <Button Grid.Column="1" Command="{Binding PreviousStepCommand}" Margin="0,0,8,0"
                            Style="{StaticResource LegacyButtonStyle}" Padding="15,6">
                        <TextBlock Text="&lt;- Atras" FontFamily="Tahoma" FontSize="9"/>
                    </Button>

                    <Button Grid.Column="2" Command="{Binding NextStepCommand}"
                            Style="{StaticResource LegacyButtonStyle}" Padding="15,6">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="{Binding NextButtonText}" FontFamily="Tahoma" FontSize="9"/>
                            <TextBlock Text=" ->" FontFamily="Tahoma" FontSize="9" Visibility="{Binding IsLastStep, Converter={StaticResource InverseBoolToVisConverter}}"/>
                        </StackPanel>
                    </Button>
                </Grid>
            </Border>
        </Grid>

        <!-- ==================== DASHBOARD CONTAINER ==================== -->
        <Grid Visibility="{Binding IsDashboardVisible, Converter={StaticResource BoolToVisConverter}}">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            
            <!-- Header del Dashboard -->
            <Border Grid.Row="0" Background="#000080" Padding="15,10" BorderBrush="#808080" BorderThickness="0,0,0,1">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    
                    <Button Grid.Column="0" Content="&lt;- Volver" 
                            Command="{Binding GoHomeCommand}"
                            Style="{StaticResource LegacyButtonStyle}"
                            Padding="12,5" Margin="0,0,15,0"/>
                    
                    <TextBlock Grid.Column="1" Text="[REGISTROS] Actividades Diarias" 
                               FontFamily="Courier New" FontSize="12" FontWeight="Bold" 
                               Foreground="White" VerticalAlignment="Center"/>
                </Grid>
            </Border>
            
            <!-- Dashboard Content -->
            <views:ControlDiarioView Grid.Row="1" DataContext="{Binding DashboardViewModel}"/>
        </Grid>

        <!-- ==================== LOADING OVERLAY ==================== -->
        <Grid Background="#80000000" Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisConverter}}">
            <Border Background="#C0C0C0" BorderThickness="2" BorderBrush="#808080" Padding="25" 
                    HorizontalAlignment="Center" VerticalAlignment="Center">
                <StackPanel>
                    <TextBlock Text="[...] Guardando" FontFamily="Courier New" FontSize="12" FontWeight="Bold"
                               HorizontalAlignment="Center" Margin="0,0,0,10"/>
                    <ProgressBar IsIndeterminate="True" Width="150" Height="18"/>
                    <TextBlock Text="Por favor espere..." FontFamily="Tahoma" FontSize="9"
                               HorizontalAlignment="Center" Foreground="#404040" Margin="0,10,0,0"/>
                </StackPanel>
            </Border>
        </Grid>

        <!-- ==================== SUCCESS OVERLAY ==================== -->
        <Grid Background="#90FFFFFF" Visibility="{Binding IsSuccessVisible, Converter={StaticResource BoolToVisConverter}}">
            <Border Background="#C0C0C0" BorderThickness="3" BorderBrush="#008000" Padding="40,30" 
                    HorizontalAlignment="Center" VerticalAlignment="Center">
                <StackPanel HorizontalAlignment="Center">
                    <!-- Icono de exito -->
                    <Border Width="80" Height="80" Background="White" BorderThickness="2" BorderBrush="#008000" Margin="0,0,0,20">
                        <TextBlock Text="[OK]" FontFamily="Courier New" FontSize="20" FontWeight="Bold" Foreground="#008000" 
                                   HorizontalAlignment="Center" VerticalAlignment="Center"/>
                    </Border>
                    
                    <TextBlock Text="Registro Guardado" FontFamily="Tahoma" FontSize="16" FontWeight="Bold" 
                               Foreground="#008000" HorizontalAlignment="Center" Margin="0,0,0,8"/>
                    
                    <TextBlock Text="{Binding SuccessMessage}" FontFamily="Tahoma" FontSize="10" 
                               Foreground="#404040" HorizontalAlignment="Center" 
                               TextAlignment="Center" MaxWidth="280" TextWrapping="Wrap"/>
                               
                    <TextBlock Text="Volviendo al menu principal..." FontFamily="Tahoma" FontSize="9" 
                               Foreground="#808080" HorizontalAlignment="Center" Margin="0,20,0,0"/>
                </StackPanel>
            </Border>
        </Grid>
    </Grid>
</UserControl>
