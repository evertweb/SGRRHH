<Window x:Class="SGRRHH.WPF.Views.EmpleadoFormWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="{Binding WindowTitle}" 
        Height="700" Width="900"
        MinHeight="600" MinWidth="800"
        WindowStartupLocation="CenterScreen"
        Background="{StaticResource ControlBrush}">
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- Encabezado -->
        <Border Grid.Row="0" Background="{StaticResource TitleBarBrush}" Padding="10,8">
            <Grid>
                <StackPanel>
                    <TextBlock Text="{Binding WindowTitle}" FontFamily="Tahoma" FontSize="14" 
                               FontWeight="Bold" Foreground="White"/>
                    <TextBlock Text="Complete la informacion del empleado" FontFamily="Tahoma" 
                               FontSize="10" Foreground="#C0C0FF" Margin="0,2,0,0"/>
                </StackPanel>
            </Grid>
        </Border>
        
        <!-- Contenido principal con scroll -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Padding="10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="180"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                
                <!-- Panel izquierdo - Foto y Documentos -->
                <StackPanel Grid.Column="0" Margin="0,0,10,0">
                    <!-- Sección Foto -->
                    <Border BorderThickness="1" BorderBrush="{StaticResource ShadowBrush}" Background="{StaticResource WhiteBrush}">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            
                            <Border Grid.Row="0" Background="#E0E0E0" Padding="{StaticResource SectionHeaderPadding}" 
                                    BorderThickness="0,0,0,1" BorderBrush="{StaticResource ShadowBrush}">
                                <TextBlock Text="FOTO EMPLEADO" FontFamily="Tahoma" FontSize="10" FontWeight="Bold"/>
                            </Border>
                            
                            <StackPanel Grid.Row="1" Margin="10">
                                <!-- Área de foto -->
                                <Border Width="130" Height="160" Background="#E0E0E0" 
                                        BorderThickness="2" BorderBrush="{StaticResource ShadowBrush}" Margin="0,0,0,10">
                                    <Border BorderThickness="2" BorderBrush="#DFDFDF">
                                        <Grid>
                                            <!-- Placeholder si no hay foto -->
                                            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center"
                                                        Visibility="{Binding FotoPath, Converter={StaticResource IsNullOrEmptyToVisibilityConverter}}">
                                                <TextBlock Text="[SIN FOTO]" FontFamily="Courier New" FontSize="10" 
                                                           HorizontalAlignment="Center" Foreground="#808080"/>
                                            </StackPanel>
                                            
                                            <!-- Imagen si hay foto -->
                                            <Image Source="{Binding FotoPath}" Stretch="UniformToFill"
                                                   Visibility="{Binding FotoPath, Converter={StaticResource NotNullToVisibilityConverter}}"/>
                                        </Grid>
                                    </Border>
                                </Border>
                                
                                <!-- Botones de foto -->
                                <Button Content="Seleccionar..." Command="{Binding SelectFotoCommand}"
                                        Style="{StaticResource LegacyButtonStyle}" Width="130" Height="22"
                                        FontFamily="Tahoma" FontSize="10" Margin="0,0,0,5"/>
                                <Button Content="Eliminar" Command="{Binding RemoveFotoCommand}"
                                        Style="{StaticResource LegacyButtonStyle}" Width="130" Height="22"
                                        FontFamily="Tahoma" FontSize="10"
                                        Visibility="{Binding FotoPath, Converter={StaticResource NotNullToVisibilityConverter}}"/>
                            </StackPanel>
                        </Grid>
                    </Border>
                    
                    <!-- Sección de Documentos - Ahora visible en crear y editar -->
                    <Border BorderThickness="1" BorderBrush="{StaticResource ShadowBrush}" Background="{StaticResource WhiteBrush}" Margin="0,10,0,0">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            
                            <Border Grid.Row="0" Background="{StaticResource SuccessBrush}" Padding="{StaticResource SectionHeaderPadding}" 
                                    BorderThickness="0,0,0,1" BorderBrush="{StaticResource ShadowBrush}">
                                <TextBlock Text="DOCUMENTOS" FontFamily="Tahoma" FontSize="10" FontWeight="Bold" Foreground="White"/>
                            </Border>
                            
                            <StackPanel Grid.Row="1" Margin="8">
                                <!-- Cédula -->
                                <Grid Margin="0,0,0,5">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <StackPanel Grid.Column="0">
                                        <TextBlock Text="Cédula *" FontFamily="Tahoma" FontSize="9" Foreground="#404040"/>
                                        <TextBlock Text="{Binding DocCedulaFileName, TargetNullValue='Sin archivo'}" 
                                                   FontFamily="Tahoma" FontSize="8" Foreground="#008000" TextTrimming="CharacterEllipsis"/>
                                    </StackPanel>
                                    <StackPanel Grid.Column="1" Orientation="Horizontal">
                                        <Button Content="..." Command="{Binding SelectDocCedulaCommand}"
                                                Style="{StaticResource LegacyButtonStyle}" Width="25" Height="18" 
                                                FontFamily="Tahoma" FontSize="9" Margin="0,0,2,0"/>
                                        <Button Content="X" Command="{Binding RemoveDocCedulaCommand}"
                                                Style="{StaticResource LegacyButtonStyle}" Width="18" Height="18" 
                                                FontFamily="Tahoma" FontSize="8"
                                                Visibility="{Binding DocCedulaFileName, Converter={StaticResource NotNullToVisibilityConverter}}"/>
                                    </StackPanel>
                                </Grid>
                                
                                <!-- Hoja de Vida -->
                                <Grid Margin="0,0,0,5">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <StackPanel Grid.Column="0">
                                        <TextBlock Text="Hoja de Vida *" FontFamily="Tahoma" FontSize="9" Foreground="#404040"/>
                                        <TextBlock Text="{Binding DocHojaVidaFileName, TargetNullValue='Sin archivo'}" 
                                                   FontFamily="Tahoma" FontSize="8" Foreground="#008000" TextTrimming="CharacterEllipsis"/>
                                    </StackPanel>
                                    <StackPanel Grid.Column="1" Orientation="Horizontal">
                                        <Button Content="..." Command="{Binding SelectDocHojaVidaCommand}"
                                                Style="{StaticResource LegacyButtonStyle}" Width="25" Height="18" 
                                                FontFamily="Tahoma" FontSize="9" Margin="0,0,2,0"/>
                                        <Button Content="X" Command="{Binding RemoveDocHojaVidaCommand}"
                                                Style="{StaticResource LegacyButtonStyle}" Width="18" Height="18" 
                                                FontFamily="Tahoma" FontSize="8"
                                                Visibility="{Binding DocHojaVidaFileName, Converter={StaticResource NotNullToVisibilityConverter}}"/>
                                    </StackPanel>
                                </Grid>
                                
                                <!-- Contrato -->
                                <Grid Margin="0,0,0,5">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <StackPanel Grid.Column="0">
                                        <TextBlock Text="Contrato" FontFamily="Tahoma" FontSize="9" Foreground="#404040"/>
                                        <TextBlock Text="{Binding DocContratoFileName, TargetNullValue='Sin archivo'}" 
                                                   FontFamily="Tahoma" FontSize="8" Foreground="#008000" TextTrimming="CharacterEllipsis"/>
                                    </StackPanel>
                                    <StackPanel Grid.Column="1" Orientation="Horizontal">
                                        <Button Content="..." Command="{Binding SelectDocContratoCommand}"
                                                Style="{StaticResource LegacyButtonStyle}" Width="25" Height="18" 
                                                FontFamily="Tahoma" FontSize="9" Margin="0,0,2,0"/>
                                        <Button Content="X" Command="{Binding RemoveDocContratoCommand}"
                                                Style="{StaticResource LegacyButtonStyle}" Width="18" Height="18" 
                                                FontFamily="Tahoma" FontSize="8"
                                                Visibility="{Binding DocContratoFileName, Converter={StaticResource NotNullToVisibilityConverter}}"/>
                                    </StackPanel>
                                </Grid>
                                
                                <!-- Certificado Bancario -->
                                <Grid Margin="0,0,0,5">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <StackPanel Grid.Column="0">
                                        <TextBlock Text="Cert. Bancario" FontFamily="Tahoma" FontSize="9" Foreground="#404040"/>
                                        <TextBlock Text="{Binding DocCertificadoBancarioFileName, TargetNullValue='Sin archivo'}" 
                                                   FontFamily="Tahoma" FontSize="8" Foreground="#008000" TextTrimming="CharacterEllipsis"/>
                                    </StackPanel>
                                    <StackPanel Grid.Column="1" Orientation="Horizontal">
                                        <Button Content="..." Command="{Binding SelectDocCertificadoBancarioCommand}"
                                                Style="{StaticResource LegacyButtonStyle}" Width="25" Height="18" 
                                                FontFamily="Tahoma" FontSize="9" Margin="0,0,2,0"/>
                                        <Button Content="X" Command="{Binding RemoveDocCertificadoBancarioCommand}"
                                                Style="{StaticResource LegacyButtonStyle}" Width="18" Height="18" 
                                                FontFamily="Tahoma" FontSize="8"
                                                Visibility="{Binding DocCertificadoBancarioFileName, Converter={StaticResource NotNullToVisibilityConverter}}"/>
                                    </StackPanel>
                                </Grid>
                                
                                <!-- Botón ver todos los documentos (solo en edición) -->
                                <Button Content="Ver Todos..." Command="{Binding OpenDocumentosCommand}"
                                        Style="{StaticResource LegacyButtonStyle}" Height="20" Margin="0,5,0,0"
                                        FontFamily="Tahoma" FontSize="9"
                                        Visibility="{Binding IsEditMode, Converter={StaticResource BoolToVisibilityConverter}}"/>
                            </StackPanel>
                        </Grid>
                    </Border>
                </StackPanel>
                
                <!-- Panel derecho - Formulario -->
                <StackPanel Grid.Column="1">
                    <!-- Datos básicos -->
                    <Border BorderThickness="1" BorderBrush="{StaticResource ShadowBrush}" Background="{StaticResource WhiteBrush}" Margin="0,0,0,10">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            
                            <Border Grid.Row="0" Background="{StaticResource TitleBarBrush}" Padding="{StaticResource SectionHeaderPadding}">
                                <TextBlock Text="DATOS BASICOS" FontFamily="Tahoma" FontSize="10" 
                                           FontWeight="Bold" Foreground="White"/>
                            </Border>
                            
                            <Grid Grid.Row="1" Margin="10">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="10"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="10"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                
                                <!-- Código -->
                                <StackPanel Grid.Column="0" Grid.Row="0" Margin="0,0,0,8">
                                    <TextBlock Text="Codigo *" FontFamily="Tahoma" FontSize="10" Margin="0,0,0,2"/>
                                    <TextBox Text="{Binding Codigo, UpdateSourceTrigger=PropertyChanged}" 
                                             Style="{StaticResource LegacyTextBoxStyle}" Height="20" FontSize="10" 
                                             IsReadOnly="True" Background="#E0E0E0"/>
                                </StackPanel>
                                
                                <!-- Cédula -->
                                <StackPanel Grid.Column="2" Grid.Row="0" Margin="0,0,0,8">
                                    <TextBlock Text="Cedula *" FontFamily="Tahoma" FontSize="10" Margin="0,0,0,2"/>
                                    <TextBox Text="{Binding Cedula, UpdateSourceTrigger=PropertyChanged}" 
                                             Style="{StaticResource LegacyTextBoxStyle}" Height="20" FontSize="10" MaxLength="20"/>
                                </StackPanel>
                                
                                <!-- Tipo de contrato -->
                                <StackPanel Grid.Column="4" Grid.Row="0" Margin="0,0,0,8">
                                    <TextBlock Text="Tipo Contrato" FontFamily="Tahoma" FontSize="10" Margin="0,0,0,2"/>
                                    <ComboBox ItemsSource="{Binding TiposContrato}"
                                              SelectedValue="{Binding TipoContrato}"
                                              SelectedValuePath="Valor"
                                              DisplayMemberPath="Nombre"
                                              Height="20" FontFamily="Tahoma" FontSize="10"/>
                                </StackPanel>
                                
                                <!-- Nombres -->
                                <StackPanel Grid.Column="0" Grid.Row="1" Margin="0,0,0,8">
                                    <TextBlock Text="Nombres *" FontFamily="Tahoma" FontSize="10" Margin="0,0,0,2"/>
                                    <TextBox Text="{Binding Nombres, UpdateSourceTrigger=PropertyChanged}" 
                                             Style="{StaticResource LegacyTextBoxStyle}" Height="20" FontSize="10" MaxLength="100"/>
                                </StackPanel>
                                
                                <!-- Apellidos -->
                                <StackPanel Grid.Column="2" Grid.Row="1" Margin="0,0,0,8">
                                    <TextBlock Text="Apellidos *" FontFamily="Tahoma" FontSize="10" Margin="0,0,0,2"/>
                                    <TextBox Text="{Binding Apellidos, UpdateSourceTrigger=PropertyChanged}" 
                                             Style="{StaticResource LegacyTextBoxStyle}" Height="20" FontSize="10" MaxLength="100"/>
                                </StackPanel>
                                
                                <!-- Fecha Ingreso -->
                                <StackPanel Grid.Column="4" Grid.Row="1" Margin="0,0,0,8">
                                    <TextBlock Text="Fecha Ingreso *" FontFamily="Tahoma" FontSize="10" Margin="0,0,0,2"/>
                                    <DatePicker SelectedDate="{Binding FechaIngreso}" Height="22" FontSize="10"/>
                                </StackPanel>
                                
                                <!-- Estado -->
                                <StackPanel Grid.Column="0" Grid.Row="2">
                                    <TextBlock Text="Estado" FontFamily="Tahoma" FontSize="10" Margin="0,0,0,2"/>
                                    <ComboBox ItemsSource="{Binding EstadosEmpleado}"
                                              SelectedValue="{Binding Estado}"
                                              SelectedValuePath="Valor"
                                              DisplayMemberPath="Nombre"
                                              Height="20" FontFamily="Tahoma" FontSize="10"/>
                                </StackPanel>
                            </Grid>
                        </Grid>
                    </Border>
                    
                    <!-- Datos personales -->
                    <Border BorderThickness="1" BorderBrush="{StaticResource ShadowBrush}" Background="{StaticResource WhiteBrush}" Margin="0,0,0,10">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            
                            <Border Grid.Row="0" Background="{StaticResource TitleBarBrush}" Padding="{StaticResource SectionHeaderPadding}">
                                <TextBlock Text="DATOS PERSONALES" FontFamily="Tahoma" FontSize="10" 
                                           FontWeight="Bold" Foreground="White"/>
                            </Border>
                            
                            <Grid Grid.Row="1" Margin="10">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="10"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="10"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                
                                <!-- Fecha Nacimiento -->
                                <StackPanel Grid.Column="0" Grid.Row="0" Margin="0,0,0,8">
                                    <TextBlock Text="Fecha Nacimiento" FontFamily="Tahoma" FontSize="10" Margin="0,0,0,2"/>
                                    <DatePicker SelectedDate="{Binding FechaNacimiento}" Height="22" FontSize="10"/>
                                </StackPanel>
                                
                                <!-- Género -->
                                <StackPanel Grid.Column="2" Grid.Row="0" Margin="0,0,0,8">
                                    <TextBlock Text="Genero" FontFamily="Tahoma" FontSize="10" Margin="0,0,0,2"/>
                                    <ComboBox ItemsSource="{Binding Generos}"
                                              SelectedValue="{Binding Genero}"
                                              SelectedValuePath="Valor"
                                              DisplayMemberPath="Nombre"
                                              Height="20" FontFamily="Tahoma" FontSize="10"/>
                                </StackPanel>
                                
                                <!-- Estado Civil -->
                                <StackPanel Grid.Column="4" Grid.Row="0" Margin="0,0,0,8">
                                    <TextBlock Text="Estado Civil" FontFamily="Tahoma" FontSize="10" Margin="0,0,0,2"/>
                                    <ComboBox ItemsSource="{Binding EstadosCiviles}"
                                              SelectedValue="{Binding EstadoCivil}"
                                              SelectedValuePath="Valor"
                                              DisplayMemberPath="Nombre"
                                              Height="20" FontFamily="Tahoma" FontSize="10"/>
                                </StackPanel>
                                
                                <!-- Dirección -->
                                <StackPanel Grid.Column="0" Grid.ColumnSpan="3" Grid.Row="1" Margin="0,0,0,8">
                                    <TextBlock Text="Direccion" FontFamily="Tahoma" FontSize="10" Margin="0,0,0,2"/>
                                    <TextBox Text="{Binding Direccion, UpdateSourceTrigger=PropertyChanged}" 
                                             Style="{StaticResource LegacyTextBoxStyle}" Height="20" FontSize="10" MaxLength="300"/>
                                </StackPanel>
                                
                                <!-- Email -->
                                <StackPanel Grid.Column="4" Grid.Row="1" Margin="0,0,0,8">
                                    <TextBlock Text="Correo Electronico" FontFamily="Tahoma" FontSize="10" Margin="0,0,0,2"/>
                                    <TextBox Text="{Binding Email, UpdateSourceTrigger=PropertyChanged}" 
                                             Style="{StaticResource LegacyTextBoxStyle}" Height="20" FontSize="10" MaxLength="200"/>
                                </StackPanel>
                                
                                <!-- Teléfono -->
                                <StackPanel Grid.Column="0" Grid.Row="2">
                                    <TextBlock Text="Telefono" FontFamily="Tahoma" FontSize="10" Margin="0,0,0,2"/>
                                    <TextBox Text="{Binding Telefono, UpdateSourceTrigger=PropertyChanged}" 
                                             Style="{StaticResource LegacyTextBoxStyle}" Height="20" FontSize="10" MaxLength="20"/>
                                </StackPanel>
                                
                                <!-- Teléfono Emergencia -->
                                <StackPanel Grid.Column="2" Grid.Row="2">
                                    <TextBlock Text="Tel. Emergencia" FontFamily="Tahoma" FontSize="10" Margin="0,0,0,2"/>
                                    <TextBox Text="{Binding TelefonoEmergencia, UpdateSourceTrigger=PropertyChanged}" 
                                             Style="{StaticResource LegacyTextBoxStyle}" Height="20" FontSize="10" MaxLength="20"/>
                                </StackPanel>
                                
                                <!-- Contacto Emergencia -->
                                <StackPanel Grid.Column="4" Grid.Row="2">
                                    <TextBlock Text="Contacto Emergencia" FontFamily="Tahoma" FontSize="10" Margin="0,0,0,2"/>
                                    <TextBox Text="{Binding ContactoEmergencia, UpdateSourceTrigger=PropertyChanged}" 
                                             Style="{StaticResource LegacyTextBoxStyle}" Height="20" FontSize="10" MaxLength="100"/>
                                </StackPanel>
                            </Grid>
                        </Grid>
                    </Border>
                    
                    <!-- Datos laborales -->
                    <Border BorderThickness="1" BorderBrush="{StaticResource ShadowBrush}" Background="{StaticResource WhiteBrush}" Margin="0,0,0,10">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            
                            <Border Grid.Row="0" Background="{StaticResource TitleBarBrush}" Padding="{StaticResource SectionHeaderPadding}">
                                <TextBlock Text="DATOS LABORALES" FontFamily="Tahoma" FontSize="10" 
                                           FontWeight="Bold" Foreground="White"/>
                            </Border>
                            
                            <Grid Grid.Row="1" Margin="10">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="10"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="10"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                
                                <!-- Departamento -->
                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="Departamento" FontFamily="Tahoma" FontSize="10" Margin="0,0,0,2"/>
                                    <ComboBox ItemsSource="{Binding Departamentos}"
                                              SelectedItem="{Binding SelectedDepartamento}"
                                              DisplayMemberPath="Nombre"
                                              Height="20" FontFamily="Tahoma" FontSize="10"/>
                                </StackPanel>
                                
                                <!-- Cargo -->
                                <StackPanel Grid.Column="2">
                                    <TextBlock Text="Cargo" FontFamily="Tahoma" FontSize="10" Margin="0,0,0,2"/>
                                    <ComboBox ItemsSource="{Binding CargosDisponibles}"
                                              SelectedItem="{Binding SelectedCargo}"
                                              DisplayMemberPath="Nombre"
                                              Height="20" FontFamily="Tahoma" FontSize="10"/>
                                </StackPanel>
                                
                                <!-- Supervisor -->
                                <StackPanel Grid.Column="4">
                                    <TextBlock Text="Supervisor" FontFamily="Tahoma" FontSize="10" Margin="0,0,0,2"/>
                                    <ComboBox ItemsSource="{Binding Supervisores}"
                                              SelectedItem="{Binding SelectedSupervisor}"
                                              DisplayMemberPath="NombreCompleto"
                                              Height="20" FontFamily="Tahoma" FontSize="10"/>
                                </StackPanel>
                            </Grid>
                        </Grid>
                    </Border>
                    
                    <!-- Observaciones -->
                    <Border BorderThickness="1" BorderBrush="{StaticResource ShadowBrush}" Background="{StaticResource WhiteBrush}">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            
                            <Border Grid.Row="0" Background="{StaticResource TitleBarBrush}" Padding="{StaticResource SectionHeaderPadding}">
                                <TextBlock Text="OBSERVACIONES" FontFamily="Tahoma" FontSize="10" 
                                           FontWeight="Bold" Foreground="White"/>
                            </Border>
                            
                            <TextBox Grid.Row="1" Text="{Binding Observaciones, UpdateSourceTrigger=PropertyChanged}"
                                     Height="60" TextWrapping="Wrap" AcceptsReturn="True"
                                     Margin="{StaticResource FormFieldPadding}" MaxLength="1000"
                                     VerticalScrollBarVisibility="Auto"
                                     Style="{StaticResource LegacyTextBoxStyle}"/>
                        </Grid>
                    </Border>
                </StackPanel>
            </Grid>
        </ScrollViewer>
        
        <!-- Barra de acciones -->
        <Border Grid.Row="2" Background="#E0E0E0" BorderThickness="0,1,0,0" BorderBrush="{StaticResource ShadowBrush}" Padding="10,8">
            <Grid>
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Left" VerticalAlignment="Center">
                    <TextBlock Text="* Campos obligatorios" FontFamily="Tahoma" FontSize="9" Foreground="#808080"/>
                </StackPanel>
                
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                    <Button Content="Cancelar" Command="{Binding CancelCommand}"
                            Style="{StaticResource LegacyButtonStyle}"
                            Width="100" Height="24" FontFamily="Tahoma" FontSize="10" Margin="0,0,10,0"/>
                    <Button Content="Guardar" Command="{Binding SaveCommand}"
                            Style="{StaticResource LegacyButtonStyle}"
                            Width="100" Height="24" FontFamily="Tahoma" FontSize="10" FontWeight="Bold"/>
                </StackPanel>
            </Grid>
        </Border>
        
        <!-- Overlay de carga -->
        <Border Grid.RowSpan="3" Background="#80000000" 
                Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibilityConverter}}">
            <Border Background="#C0C0C0" BorderThickness="2" BorderBrush="#808080" Padding="30"
                    HorizontalAlignment="Center" VerticalAlignment="Center">
                <Border BorderThickness="2" BorderBrush="White">
                    <StackPanel Margin="20">
                        <TextBlock Text="Procesando..." FontFamily="Tahoma" FontSize="12" FontWeight="Bold"
                                   Foreground="#000080" HorizontalAlignment="Center"/>
                        <TextBlock Text="Por favor espere..." FontFamily="Tahoma" FontSize="10" 
                                   Foreground="#808080" HorizontalAlignment="Center" Margin="0,5,0,0"/>
                    </StackPanel>
                </Border>
            </Border>
        </Border>
    </Grid>
</Window>
